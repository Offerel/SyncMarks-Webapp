function sendRequest(e,t=null,n=null){const o={action:e.name,client:0,data:t,add:n,sync:null},d=new XMLHttpRequest;d.open("POST",document.location.href,!0),d.setRequestHeader("Content-type","application/x-www-form-urlencoded"),d.responseType="json",d.onreadystatechange=function(){if(4===d.readyState){if(200!==d.status){let t=`Error ${d.status}: ${d.statusText}`;return show_noti({title:"Syncmarks - Error",url:t,key:""},!1),console.error(e.name,t),!1}e(d.response,n)}},d.onerror=function(){let t="Error: "+d.status+" | "+d.response;return show_noti({title:"Syncmarks - Error",url:t,key:""},!1),console.error(e.name,t),!1};const l=new URLSearchParams(o);d.send(l)}function getclients(e,t=""){let n=e;var o=document.getElementById("mngcform");o.childNodes.length&&o.removeChild(o.firstChild);var d=document.createElement("ul");n.forEach(function(e,t){if("0"!=e.id){let t=document.createElement("li");t.title=e.id,t.dataset.type=e.type.toLowerCase(),t.id=e.id,t.classList="client";let n=document.createElement("div");n.classList="clientname",n.appendChild(document.createTextNode(e.name?e.name:e.id)),t.appendChild(n);let o=document.createElement("input");o.type="text",o.name="cname",o.value=e.name,n.appendChild(o);let l=document.createElement("div");l.classList="lastseen",l.innerText="0"!=e.date?"Sync: "+new Date(parseInt(e.date)).toLocaleString(navigator.language,{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"Sync: -- -- ---- -- --",n.appendChild(l);let i=document.createElement("div");i.classList="fa-edit rename",i.addEventListener("click",mvClient,!1),t.appendChild(i);let r=document.createElement("div");r.classList="fa-trash remove",r.addEventListener("click",delClient,!1),t.appendChild(r),d.appendChild(t)}}),o.appendChild(d),document.getElementById("mngcform").style.display="block",document.querySelector("#bookmarks").addEventListener("click",hideMenu,!1)}function addmark(e,t=""){document.getElementById("bookmarks").innerHTML=e,document.querySelectorAll(".file").forEach(e=>e.addEventListener("contextmenu",onContextMenu,!1)),document.querySelectorAll(".folder").forEach(e=>e.addEventListener("contextmenu",onContextMenu,!1)),console.info("Bookmark added successfully.")}function logRefresh(){let e=document.getElementById("arefresh").checked,t=document.getElementById("logfile");if("visible"===t.style.visibility){let e=new XMLHttpRequest,t="action=mrefresh";e.onreadystatechange=function(){if(4==this.readyState)if(200==this.status){const e=document.getElementById("lfiletext");for(;e.firstChild;)e.firstChild.remove();let t=this.responseText.split("\n");t.forEach(function(t){let n=document.createElement("span");t.indexOf("debug")>0?n.classList.add("debug"):t.indexOf("notice")>0?n.classList.add("notice"):t.indexOf("warn")>0?n.classList.add("warn"):t.indexOf("error")>0&&n.classList.add("error"),n.innerText=t,e.appendChild(n)}),moveEnd()}else{let e="Error couldnt reload logfile.";console.error(e),show_noti({title:"Syncmarks - Error",url:e,key:""},!1)}},e.open("POST",document.location.href,!0),e.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),e.send(t)}!0===e&&setTimeout(logRefresh,3e4)}function mngUform(e,t){t.options.length=1,e.forEach(function(e){let n=document.createElement("option");n.text=e.userName,n.value=e.userID,n.dataset.lvl=e.userType,t.appendChild(n)})}function movBookmark(e,t){let n="action=bmmv&folder="+e+"&id="+t,o=new XMLHttpRequest;o.onreadystatechange=function(){if(4==this.readyState&&200==this.status)if(1==this.responseText){let n=document.getElementById(t).parentElement,o=document.getElementById("f_"+e);n.remove(),o.lastChild.appendChild(n)}else{let e="Error moving bookmark";show_noti({title:"Syncmarks - Error",url:e,key:""},!1),console.error(e)}},o.open("POST",document.location.href,!0),o.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),o.send(n)}function delClient(e){let t=new XMLHttpRequest,n="action=adel&client="+e.target.parentElement.id;t.onreadystatechange=function(){4==t.readyState&&200==t.status&&(document.getElementById("mngcform").innerHTML=t.responseText,document.querySelectorAll("#mngcform li div.remove").forEach(function(e){e.addEventListener("click",delClient,!1)}),document.querySelectorAll("#mngcform li div.rename").forEach(function(e){e.addEventListener("click",mvClient,!1)}))},t.open("POST",document.location.href,!0),t.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),t.send(n)}function mvClient(e){let t=document.createElement("div");t.classList.add("db-spinner"),t.id="db-spinner",document.querySelector("body").appendChild(t);let n=new XMLHttpRequest,o="action=arename&client="+e.target.parentElement.id+"&nname="+e.target.parentElement.children[0].children.cname.value;n.onreadystatechange=function(){4==n.readyState&&200==n.status&&(document.getElementById("mngcform").innerHTML=n.response,document.querySelectorAll("#mngcform li div.remove").forEach(function(e){e.addEventListener("click",delClient,!1)}),document.querySelectorAll("#mngcform li div.rename").forEach(function(e){e.addEventListener("click",mvClient,!1)}),t.remove())},n.open("POST",document.location.href,!0),n.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),n.responseType="json",n.send(o)}function resize(e){let t=window.innerWidth-parseInt(e.x);document.getElementById("logfile").style.width=t+"px"}function moveEnd(){let e=document.getElementById("lfiletext");e.scrollTop=e.scrollHeight}function delBookmark(e,t){if(confirm('Would you like to delete "'+t+'"?')){let t=new XMLHttpRequest,n="action=mdel&id="+e,o=document.createElement("div");o.classList.add("db-spinner"),o.id="db-spinner",document.querySelector("body").appendChild(o),t.onreadystatechange=function(){if(4==this.readyState)if(document.getElementById("db-spinner").remove(),200==this.status)hideMenu(),document.getElementById(e).parentNode.remove();else{let e="There was a problem removing that bookmark.";show_noti({title:"Syncmarks - Error",url:e,key:""},!1),console.error(e)}},t.open("POST",document.location.href,!0),t.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),t.send(n)}}function enableSave(){document.getElementById("url").value.length>7?document.getElementById("save").disabled=!1:document.getElementById("save").disabled=!0}function showMenu(e,t){var n=document.querySelector(".menu"),o=window.innerHeight-120;t>=o&&(t=o),n.style.left=e+"px",n.style.top=t+"px",n.style.opacity=1,n.classList.add("show-menu")}function hideMenu(){let e=document.querySelector(".menu");e.classList.remove("show-menu"),e.style.display="none",document.querySelectorAll(".mmenu").forEach(function(e){e.style.display="none"}),document.querySelectorAll(".mbmdialog").forEach(function(e){e.style.display="none"}),document.getElementById("dubDIV")&&document.querySelector("body").removeChild(document.getElementById("dubDIV")),document.getElementById("mnguform")&&document.getElementById("mnguform").remove()}function onContextMenu(e){e.preventDefault(),hideMenu();let t=document.querySelector(".menu");t.style.display="block",e.target.attributes.id?(document.getElementById("bmid").value=e.target.attributes.id.value,document.getElementById("bmid").title=e.target.attributes.title.value,document.getElementById("btnMove").setAttribute("style","display:block !important"),document.getElementById("btnFolder").setAttribute("style","display:block !important")):(document.getElementById("bmid").value=e.target.nextElementSibling.value,document.getElementById("bmid").title=e.target.textContent,document.getElementById("btnMove").setAttribute("style","display:none !important"),document.getElementById("btnFolder").setAttribute("style","display:none !important")),showMenu(e.pageX,e.pageY),document.querySelector("#btnEdit").addEventListener("click",onClick,!1),document.querySelector("#btnMove").addEventListener("click",onClick,!1),document.querySelector("#btnDelete").addEventListener("click",onClick,!1),document.querySelector("#btnFolder").addEventListener("click",onClick,!1)}function onClick(e){var t=155,n=window.innerHeight-200,o=e.pageX,d=e.pageY;switch(o<=t&&(o=t),d>=n&&(d=n),this.id){case"btnEdit":document.getElementById("edtitle").value=document.getElementById("bmid").title,document.getElementById("edid").value=document.getElementById("bmid").value,document.getElementById(document.getElementById("bmid").value)?(document.getElementById("edurl").value=document.getElementById(document.getElementById("bmid").value).href,document.getElementById("bmarkedt").firstChild.innerText="Edit Bookmark",document.getElementById("edurl").type="text"):(document.getElementById("edurl").value="",document.getElementById("edurl").type="hidden",document.getElementById("bmarkedt").firstChild.innerText="Edit Folder"),hideMenu(),document.getElementById("bmarkedt").style.left=o,document.getElementById("bmarkedt").style.top=d,document.getElementById("bmarkedt").style.display="block";break;case"btnMove":document.getElementById("mvtitle").value=document.getElementById("bmid").title,document.getElementById("mvid").value=document.getElementById("bmid").value,hideMenu(),document.getElementById("bmamove").style.left=o,document.getElementById("bmamove").style.top=d,document.getElementById("bmamove").style.display="block";break;case"btnDelete":delBookmark(document.getElementById("bmid").value,document.getElementById("bmid").title);break;case"btnFolder":hideMenu(),document.getElementById("folderf").style.left=o,document.getElementById("folderf").style.top=d,document.getElementById("folderf").style.display="block",document.getElementById("fbid").value=document.getElementById("bmid").value}document.removeEventListener("click",onClick)}function openMessages(e){var t,n,o;for(n=document.getElementsByClassName("tabcontent"),t=0;t<n.length;t++)n[t].style.display="none";let d=document.querySelector("#"+e.target.dataset.val+" .NotiTable .NotiTableBody");for(;d.firstChild;)d.removeChild(d.lastChild);let l=new XMLHttpRequest,i="action=rmessage&lp="+e.target.dataset.val;for(l.onreadystatechange=function(){if(4==l.readyState&&200==l.status){const e=(new DOMParser).parseFromString(l.responseText,"text/html");Array.from(e.body.children).forEach(e=>{e.children[1].children[0].addEventListener("click",delMessage,!1),d.appendChild(e)})}},l.open("POST",document.location.href,!0),l.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),l.send(i),o=document.getElementsByClassName("tablinks"),t=0;t<o.length;t++)o[t].className=o[t].className.replace(" active","");document.getElementById(e.target.dataset.val).style.display="block",e.currentTarget.className+=" active"}function delMessage(e){let t=document.createElement("div");t.classList.add("db-spinner"),t.id="db-spinner",document.querySelector("body").appendChild(t);let n=e.target.parentElement.parentElement.parentElement.parentElement.parentElement.id,o=new XMLHttpRequest,d="action=rmessage&lp="+n+"&message="+e.target.dataset.message;o.onreadystatechange=function(){4==this.readyState&&200==this.status&&(document.querySelector("#"+n+" .NotiTable .NotiTableBody").innerHTML=this.responseText,document.querySelectorAll(".NotiTableCell .fa-trash").forEach(function(e){e.addEventListener("click",delMessage,!1)}),t.remove())},o.open("POST",document.location.href,!0),o.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),o.send(d)}function eNoti(e){var t=e.target.checked;if(t)if("Notification"in window)if("granted"===Notification.permission){new Notification("Syncmarks",{body:"Notifications will be enabled for Syncmarks.",icon:"./images/bookmarks192.png"});setOption("notifications",1)}else"denied"!==Notification.permission&&Notification.requestPermission().then(function(e){if("granted"===e){new Notification("Syncmarks",{body:"Notifications will be enabled for Syncmarks.",icon:"./images/bookmarks192.png"});setOption("notifications",1)}});else alert("This browser does not support desktop notification"),setOption("notifications",0);else setOption("notifications",0)}function setOption(e,t){let n=new XMLHttpRequest,o="action=soption&option="+e+"&value="+t;n.onreadystatechange=function(){if(4==this.readyState&&200==this.status)if("1"===this.responseText)console.info("Option saved.");else{let e="There was a problem, saving the option";show_noti({title:"Syncmarks - Error",url:e,key:""},!1),console.error(e)}},n.open("POST",document.location.href,!0),n.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),n.send(o)}function rNot(e){let t=new XMLHttpRequest,n="action=durl&durl="+e;t.onreadystatechange=function(){if(4==this.readyState&&200==this.status)if("1"===this.response)console.info("Notification removed");else{let e="Problem removing notification, please check server log.";console.error(e),show_noti({title:"Syncmarks - Error",url:e,key:""},!1)}},t.open("POST",document.location.href,!0),t.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),t.responseType="json",t.send(n)}function show_noti(e,t=!0){if("granted"!==Notification.permission)Notification.requestPermission();else{let n=new Notification(e.title,{body:e.url,icon:"./images/bookmarks192.png",requireInteraction:t});n.onclick=function(){e.url.indexOf("http")>=0&&(window.open(e.url),rNot(e.nkey))}}}function getNotifications(){let e=new XMLHttpRequest,t="action=gurls";e.onreadystatechange=function(){if(4==this.readyState&&200==this.status){let e=this.response;1==e[0].nOption&&e.forEach(function(e){show_noti(e)})}},e.open("POST",document.location.href,!0),e.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),e.responseType="json",e.send(t),sessionStorage.setItem("gNoti","1")}document.addEventListener("DOMContentLoaded",function(){var e;(document.getElementById("uf")&&document.getElementById("uf").focus(),document.getElementById("loginbody")&&(document.getElementById("hmenu").classList.add("inlogin1"),document.querySelector("#menu button").classList.add("inlogin2")),document.getElementById("bookmarks"))&&(document.querySelector("#menu input").addEventListener("keyup",function(e){var t=this.value,n=document.querySelectorAll("#bookmarks li.file"),o=document.getElementById("bookmarks");o.innerHTML="",n.forEach(e=>{o.appendChild(e),e.innerText.toUpperCase().includes(t.toUpperCase())||e.firstChild.attributes.href.nodeValue.toUpperCase().includes(t.toUpperCase())?(e.style.display="block",e.style.paddingLeft="20px"):e.style.display="none"}),""!=t&&27!=e.keyCode||(o.innerHTML=document.getElementById("hmarks").innerHTML,document.querySelector("#menu input").value="")}),document.querySelector("#menu button").addEventListener("click",function(){"×"==document.querySelector("#menu button").innerHTML?(document.querySelector("#menu input").blur(),document.querySelector("#menu button").innerHTML="⌕",document.querySelector("#menu button").classList.remove("asform"),document.querySelector("#menu input").classList.remove("asform"),document.querySelector("#menu input").classList.add("isform"),document.getElementById("mprofile").style.display="block"):(document.querySelector("#menu button").innerHTML="×",document.querySelector("#menu button").classList.add("asform"),document.querySelector("#menu input").classList.remove("isform"),document.querySelector("#menu input").classList.add("asform"),document.getElementById("mprofile").style.display="none",document.querySelector("#menu input").focus()),hideMenu()}),document.getElementById("mprofile").addEventListener("click",function(){"×"==document.querySelector("#menu button").innerHTML?(document.querySelector("#menu input").blur(),document.querySelector("#menu button").innerHTML="⌕",document.querySelector("#menu button").classList.remove("asform"),document.querySelector("#menu input").classList.remove("asform"),document.querySelector("#menu input").classList.add("isform"),document.getElementById("mprofile").style.display="block"):(document.querySelector("#menu button").innerHTML="×",document.querySelector("#menu button").classList.add("asform"),document.querySelector("#menu input").classList.remove("isform"),document.querySelector("#menu input").classList.add("asform"),document.getElementById("mprofile").style.display="none",document.querySelector("#menu input").focus()),hideMenu()}),document.getElementById("bmsearch").addEventListener("keydown",function(e){"Escape"===e.key&&(document.querySelector("#menu input").blur(),document.querySelector("#menu button").innerHTML="⌕",document.querySelector("#menu button").classList.remove("asform"),document.querySelector("#menu input").classList.remove("asform"),document.querySelector("#menu input").classList.add("isform"),document.getElementById("mprofile").style.display="block",document.getElementById("bookmarks").innerHTML=document.getElementById("hmarks").innerHTML)}),document.getElementById("logfile")&&document.getElementById("logfile").addEventListener("mousedown",function(e){e.offsetX<3&&document.addEventListener("mousemove",resize,!1)},!1),document.addEventListener("mouseup",function(){document.removeEventListener("mousemove",resize,!1)},!1),document.querySelectorAll(".file").forEach(function(e){e.addEventListener("contextmenu",onContextMenu,!1),e.addEventListener("dragstart",function(e){e.target.style.opacity=".3",e.dataTransfer.effectAllowed="move"}),e.addEventListener("dragend",function(e){e.target.style.opacity=""})}),document.querySelectorAll(".folder").forEach(e=>e.addEventListener("contextmenu",onContextMenu,!1)),document.querySelectorAll(".lbl").forEach(function(t){t.addEventListener("dragover",function(e){e.preventDefault(),e.dataTransfer.dropEffect="move"}),t.addEventListener("dragenter",function(){this.style="background-color: lightblue;"}),t.addEventListener("dragleave",function(){this.style="background-color: unset;"}),t.addEventListener("drop",function(t){t.preventDefault(),movBookmark(t.target.htmlFor.substring(2),e.target.id),t.target.style="background-color: unset;"})}),document.addEventListener("drag",function(t){e=t}),document.querySelectorAll(".tablinks").forEach(e=>e.addEventListener("click",openMessages,!1)),document.querySelectorAll(".NotiTableCell .fa-trash").forEach(e=>e.addEventListener("click",delMessage,!1)),document.querySelector("#cnoti").addEventListener("change",eNoti,!1),1!=sessionStorage.getItem("gNoti")&&getNotifications(),document.addEventListener("keydown",e=>{"Escape"===e.key&&hideMenu()}),document.querySelector("#mngcform input[type='text']")&&document.querySelector("#mngcform input[type='text']").addEventListener("focus",function(){this.select()}),document.getElementById("save").addEventListener("click",function(e){e.preventDefault(),hideMenu();document.getElementById("folder").value,encodeURIComponent(document.getElementById("url").value);let t=JSON.stringify({id:Math.random().toString(24).substring(2,12),url:document.getElementById("url").value,title:"",type:"bookmark",folder:document.getElementById("folder").value,nfolder:"More Bookmarks",added:(new Date).valueOf()});sendRequest(addmark,t,2)}),document.getElementById("npwd")&&document.getElementById("npwd").addEventListener("input",function(){checkuform()}),document.getElementById("nuser")&&document.getElementById("nuser").addEventListener("input",function(){checkuform()}),document.getElementById("userLevel")&&document.getElementById("userLevel").addEventListener("input",function(){checkuform()}),document.getElementById("hmenu").addEventListener("click",function(){var e=document.getElementById("mainmenu");document.querySelector("#bookmarks")&&document.querySelector("#bookmarks").addEventListener("click",hideMenu,!1),"block"===e.style.display?e.style.display="none":(hideMenu(),e.style.display="block")}),document.getElementById("mngusers")&&document.getElementById("mngusers").addEventListener("click",function(){hideMenu();let e=new XMLHttpRequest,t="action=getUsers";return e.onreadystatechange=function(){if(4==this.readyState&&200==this.status){let t=JSON.parse(e.responseText);if(-1!=t.indexOf("not allowed"))console.warn("SyncMarks - Warning: "+t),show_noti({title:"Syncmarks - Warning",url:t,key:""},!1);else{document.querySelector("#bookmarks").addEventListener("click",hideMenu,!1);let e=document.createElement("div");e.id="mnguform",e.classList.add("mbmdialog"),e.style.display="block";let n=document.createElement("h6");n.appendChild(document.createTextNode("Manage Users")),e.appendChild(n);let o=document.createElement("select");o.id="userSelect";let d=document.createElement("option");d.text="-- Add new user --",d.value=0,o.appendChild(d),mngUform(t,o);let l=document.createElement("input");l.id="nuser",l.placeholder="Username",l.type="text",l.required=!0,l.autocomplete="username";let i=document.createElement("input");i.id="npwd",i.placeholder="Password",i.type="password",i.autocomplete="password";let r=document.createElement("select");r.id="userLevel";let a=document.createElement("option");a.text="Normal",a.value=1,r.appendChild(a);let s=document.createElement("option");s.text="Admin",s.value=2,r.appendChild(s);let c=document.createElement("div");c.classList.add("dbutton");let u=document.createElement("button");u.id="muadd",u.type="submit",u.disabled=!0,u.innerText="Save";let m=document.createElement("button");m.id="mudel",m.type="submit",m.disabled=!0,m.innerText="Delete",c.appendChild(u),c.appendChild(m),o.addEventListener("change",function(e){0!=e.target.options[e.target.selectedIndex].value?(l.value=e.target.options[e.target.selectedIndex].text,r.value=e.target.options[e.target.selectedIndex].dataset.lvl,m.disabled=!1):(l.value="",r.value=1,m.disabled=!0)}),l.addEventListener("input",function(){u.disabled=this.originalValue==this.value&&""==this.value}),i.addEventListener("input",function(){u.disabled=this.originalValue==this.value&&""==this.value}),r.addEventListener("change",function(){u.disabled=!1}),e.appendChild(o),e.appendChild(l),e.appendChild(i),e.appendChild(r),e.appendChild(c),document.querySelector("body").appendChild(e),u.addEventListener("click",function(e){e.preventDefault();let t=document.createElement("div");t.classList.add("db-spinner"),t.id="db-spinner",document.querySelector("body").appendChild(t);let n=new XMLHttpRequest,d=0==o.selectedIndex?1:2,a="action=muedt&type="+d+"&p="+i.value+"&userLevel="+r.value+"&nuser="+l.value+"&userSelect="+o.options[o.selectedIndex].value;n.onreadystatechange=function(){if(4==this.readyState&&200==this.status){let e=JSON.parse(n.responseText);-1!=e.indexOf("failed")?(console.error("Syncmarks: "+e),show_noti({title:"Syncmarks - Error",url:e,key:""},!1)):-1!=e.indexOf("not send")?console.warn("Syncmarks: "+e):console.info("Syncmarks: "+e);let d=new XMLHttpRequest,l="action=getUsers";d.onreadystatechange=function(){if(4==this.readyState&&200==this.status){t.remove();let e=JSON.parse(d.responseText);-1!=e.indexOf("not allowed")?show_noti({title:"Syncmarks - Warning",url:e,key:""},!1):mngUform(e,o)}},d.open("POST",document.location.href,!0),d.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),d.send(l)}},n.open("POST",document.location.href,!0),n.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),n.send(a)}),m.addEventListener("click",function(e){e.preventDefault();let t=document.createElement("div");t.classList.add("db-spinner"),t.id="db-spinner",document.querySelector("body").appendChild(t);let n=new XMLHttpRequest,d="action=muedt&type=3&userLevel="+r.value+"&nuser="+l.value+"&userSelect="+o.options[o.selectedIndex].value;n.onreadystatechange=function(){if(4==this.readyState&&200==this.status){let e=JSON.parse(n.responseText);-1!=e.indexOf("failed")?(console.error("Syncmarks: "+e),show_noti({title:"Syncmarks - Error",url:e,key:""},!1)):-1!=e.indexOf("not send")?console.warn("Syncmarks: "+e):console.info("Syncmarks: "+e);let d=new XMLHttpRequest,l="action=getUsers";d.onreadystatechange=function(){if(4==this.readyState&&200==this.status){t.remove();let e=JSON.parse(d.responseText);-1!=e.indexOf("not allowed")?show_noti({title:"Syncmarks - Warning",url:e,key:""},!1):mngUform(e,o)}},d.open("POST",document.location.href,!0),d.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),d.send(l)}},n.open("POST",document.location.href,!0),n.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),n.send(d)})}}},e.open("POST",document.location.href,!0),e.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),e.send(t),!1}),document.getElementById("muser").addEventListener("click",function(e){e.preventDefault(),hideMenu(),document.getElementById("userform").style.display="block",document.querySelector("#bookmarks").addEventListener("click",hideMenu,!1)}),document.getElementById("mmail").addEventListener("click",function(e){e.preventDefault(),document.getElementById("mailform")&&document.getElementById("mailform").remove(),hideMenu();let t=document.createElement("div");t.id="mailform",t.classList.add("mbmdialog");let n=document.createElement("h6");n.appendChild(document.createTextNode("Change E-Mail"));let o=document.createElement("input");o.id="mput",o.value=document.getElementById("userMail").innerText;let d=document.createElement("div");d.classList.add("dbutton");let l=document.createElement("button");l.id="mchange",l.type="submit",l.disabled=!0,l.innerText="Save",d.appendChild(l),o.addEventListener("input",function(){l.disabled=this.originalValue==this.value&&""==this.value}),l.addEventListener("click",function(){let e=new XMLHttpRequest,n="action=cmail&mail="+o.value;e.onreadystatechange=function(){if(4==this.readyState&&200==this.status){let e=JSON.parse(this.responseText);if(1==e)document.getElementById("userMail").innerText=o.value,console.info("Mail changed."),t.remove();else{let t=e;console.error(t),show_noti({title:"Syncmarks - Error",url:t,key:""},!1)}}},e.open("POST",document.location.href,!0),e.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),e.send(n)}),t.appendChild(n),t.appendChild(o),t.appendChild(d),document.querySelector("body").appendChild(t),document.getElementById("mailform").style.display="block",document.querySelector("#bookmarks").addEventListener("click",hideMenu,!1)}),document.querySelectorAll(".mdcancel").forEach(e=>e.addEventListener("click",function(){hideMenu()})),document.getElementById("mpassword").addEventListener("click",function(){hideMenu(),document.getElementById("passwordform").style.display="block",document.querySelector("#bookmarks").addEventListener("click",hideMenu,!1)}),document.getElementById("pbullet").addEventListener("click",function(){hideMenu(),document.getElementById("pbulletform").style.display="block",document.querySelector("#bookmarks").addEventListener("click",hideMenu,!1)}),document.getElementById("nmessages").addEventListener("click",function(){hideMenu();let e=new XMLHttpRequest,t="action=rmessage&lp=aNoti";e.onreadystatechange=function(){if(4==e.readyState&&200==e.status){const t=(new DOMParser).parseFromString(e.responseText,"text/html");let n=document.querySelector("#aNoti .NotiTable .NotiTableBody");Array.from(t.body.children).forEach(e=>{e.children[1].children[0].addEventListener("click",delMessage,!1),n.appendChild(e)})}},e.open("POST",document.location.href,!0),e.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),e.send(t),document.getElementById("nmessagesform").style.display="block",document.querySelector("#bookmarks").addEventListener("click",hideMenu,!1)}),document.getElementById("clientedt").addEventListener("click",function(){hideMenu(),sendRequest(getclients)}),document.getElementById("psettings").addEventListener("click",function(){hideMenu(),document.getElementById("mngsform").style.display="block",document.querySelector("#bookmarks").addEventListener("click",hideMenu,!1)}),document.getElementById("duplicates").addEventListener("click",function(){hideMenu();let e=document.createElement("div");e.classList.add("db-spinner"),e.id="db-spinner",document.querySelector("body").appendChild(e);var t=new XMLHttpRequest,n="action=checkdups";return t.onreadystatechange=function(){if(4==this.readyState)if(200==this.status){let t=JSON.parse(this.responseText);if(t.length>0){let n=document.createElement("div"),o=document.createElement("h6");o.innerText=t.length+" duplicates found";let d=document.createElement("span");d.innerText="Click on a entry to delete the duplicate",n.id="dubDIV",n.classList.add("mbmdialog"),n.appendChild(o),n.appendChild(d),document.querySelector("body").appendChild(n);let l=document.createElement("ul");l.id="dubMenu",t.forEach(function(e){let t=document.createElement("ul");t.classList.add("dubSub");let o=document.createElement("li");o.id="dub_"+e.bmID,o.innerText=e.bmTitle,o.dataset.url=e.bmURL,o.title=e.bmURL,e.subs.forEach(function(e){let n=document.createElement("li");n.classList.add("menuitem"),n.innerText=e.bmTitle,n.dataset.bmid=e.bmID,n.addEventListener("click",function(){let e=new XMLHttpRequest,t=this,n="action=mdel&rc=1&id="+t.dataset.bmid,o=document.createElement("div");o.classList.add("db-spinner"),o.id="db-spinner",document.querySelector("body").appendChild(o),e.open("POST",document.location.href,!0),e.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),e.addEventListener("load",function(n){e.status>=200&&e.status<300&&(t.style.display="none",document.getElementById(t.dataset.bmid).parentNode.remove(),document.getElementById("db-spinner").remove())}),e.send(n)});let o=document.createElement("span");o.innerHTML=e.fway,o.title=o.innerHTML,n.appendChild(o),t.appendChild(n)}),o.appendChild(t),l.appendChild(o),n.appendChild(l),n.style.display="block"}),e.remove()}else e.remove(),console.info("No duplicates found"),show_noti({title:"Syncmarks - Info",url:"No duplicates found",key:""},!1)}else show_noti({title:"Syncmarks - Error",url:"Error checking for duplicates, please check server log.",key:""},!1)},t.open("POST",document.location.href,!0),t.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),t.send(n),!1}),document.getElementById("bexport").addEventListener("click",function(){hideMenu();var e=new Date,t=e.getDate(),n=e.getMonth()+1,o=e.getFullYear();t<10&&(t="0"+t),n<10&&(n="0"+n),e=t+"-"+n+"-"+o;var d=new XMLHttpRequest,l="action=bexport&type=html";return d.onreadystatechange=function(){if(4==this.readyState)if(200==this.status){var t=new Blob([this.response],{type:"text/html"}),n=document.createElement("a");n.href=window.URL.createObjectURL(t),n.download="bookmarks_"+e+".html",n.click(),console.info("HTML export successfully, please look in your download folder.")}else{let e="Error generating export, please check server log.";console.error(e),show_noti({title:"Syncmarks - Error",url:e,key:""},!1)}},d.open("POST",document.location.href,!0),d.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),d.responseType="json",d.send(l),!1}),document.getElementById("footer").addEventListener("click",function(){hideMenu(),document.querySelector("#bookmarks").addEventListener("click",hideMenu,!1),document.getElementById("bmarkadd").style.display="block",url.focus(),url.addEventListener("input",enableSave)}),document.getElementById("mlog")&&document.getElementById("mlog").addEventListener("click",function(){hideMenu();let e=document.getElementById("logfile");if("visible"===e.style.visibility)e.style.visibility="hidden",document.getElementById("close").style.visibility="hidden";else{e.style.visibility="visible",document.getElementById("close").style.visibility="visible";let t=new XMLHttpRequest,n="action=mlog";t.onreadystatechange=function(){if(4==this.readyState)if(200==this.status){const e=document.getElementById("lfiletext");for(;e.firstChild;)e.firstChild.remove();let t=this.responseText.split("\n");t.forEach(function(t){let n=document.createElement("span");t.indexOf("debug")>0?n.classList.add("debug"):t.indexOf("notice")>0?n.classList.add("notice"):t.indexOf("warn")>0?n.classList.add("warn"):t.indexOf("error")>0&&n.classList.add("error"),n.innerText=t,e.appendChild(n)}),moveEnd()}else{
let e="Error loading logfile, please check server log.";show_noti({title:"Syncmarks - Error",url:e,key:""},!1),console.error(e)}},t.open("POST",document.location.href,!0),t.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),t.send(n)}}),document.getElementById("mclear")&&document.getElementById("mclear").addEventListener("click",function(){document.getElementById("logfile");let e=new XMLHttpRequest,t="action=mclear";e.onreadystatechange=function(){if(4==this.readyState)if(200==this.status){const e=document.getElementById("lfiletext");for(;e.firstChild;)e.firstChild.remove();let t=this.responseText.split("\n");t.forEach(function(t){let n=document.createElement("span");t.indexOf("debug")>0?n.classList.add("debug"):t.indexOf("notice")>0?n.classList.add("notice"):t.indexOf("warn")>0?n.classList.add("warn"):t.indexOf("error")>0&&n.classList.add("error"),n.innerText=t,e.appendChild(n)}),moveEnd(),console.info("Logfile should now be empty.")}else{let e="Error couldnt clear logfile.";console.error(e),show_noti({title:"Syncmarks - Error",url:e,key:""},!1)}},e.open("POST",document.location.href,!0),e.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),e.send(t)}),document.getElementById("mrefresh")&&document.getElementById("mrefresh").addEventListener("click",logRefresh),document.getElementById("arefresh")&&document.getElementById("arefresh").addEventListener("change",logRefresh),document.getElementById("mclose")&&document.getElementById("mclose").addEventListener("click",function(){"visible"===document.getElementById("logfile").style.visibility&&(document.getElementById("logfile").style.visibility="hidden",document.getElementById("close").style.visibility="hidden")}),document.querySelectorAll("#mngcform .clientname").forEach(function(e){e.addEventListener("touchstart",function(){this.children[0].style.display="block"})}),document.querySelectorAll("#mngcform li div.clientname input").forEach(function(e){e.addEventListener("mouseleave",function(){this.defaultValue!=this.value&&(this.style.display="block",this.parentElement.parentElement.children[2].classList.add("renamea"),this.parentElement.parentElement.children[1].classList.add("renamea"),this.parentElement.parentElement.children[1].classList.remove("rename"),this.parentElement.parentElement.children[2].classList.remove("remove"))})}),document.getElementById("fname").addEventListener("input",function(){document.getElementById("fsave").disabled=!1}),document.getElementById("edtitle").addEventListener("input",function(){document.getElementById("edsave").disabled=!1}),document.getElementById("edurl").addEventListener("input",function(){document.getElementById("edsave").disabled=!1}),document.getElementById("mvfolder").addEventListener("change",function(){document.getElementById("mvsave").disabled=!1}),document.getElementById("fsave").addEventListener("click",function(e){e.preventDefault();let t=new XMLHttpRequest,n="action=cfolder&fname="+document.getElementById("fname").value+"&fbid="+document.getElementById("fbid").value;return t.onreadystatechange=function(){if(4==this.readyState&&200==this.status)if(1==this.responseText)location.href=location.href;else{let e="There was a problem adding the new folder.";console.error(e),show_noti({title:"Syncmarks - Error",url:e,key:""},!1)}},t.open("POST",document.location.href,!0),t.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),t.send(n),hideMenu(),!1}),document.getElementById("edsave").addEventListener("click",function(e){e.preventDefault();let t=new XMLHttpRequest,n="action=bmedt&title="+document.getElementById("edtitle").value+"&url="+document.getElementById("edurl").value+"&id="+document.getElementById("edid").value;return t.onreadystatechange=function(){if(4==this.readyState&&200==this.status)if(1==this.responseText)location.reload();else{let e="There was a problem changing that bookmark.";console.error(e),show_noti({title:"Syncmarks - Error",url:e,key:""},!1)}},t.open("POST",document.location.href,!0),t.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),t.send(n),!1}),document.getElementById("mvsave").addEventListener("click",function(e){e.preventDefault(),movBookmark(document.getElementById("mvfolder").value,document.getElementById("mvid").value),document.getElementById("bmamove").style.display="none"}))},!1);