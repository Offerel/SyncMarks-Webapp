/**
 * SyncMarks
 *
 * @version 1.6.1
 * @author Offerel
 * @copyright Copyright (c) 2021, Offerel
 * @license GNU General Public License, version 3
 */
function mngUform(e,t){t.options.length=1,e.forEach((function(e){let n=document.createElement("option");n.text=e.userName,n.value=e.userID,n.dataset.lvl=e.userType,t.appendChild(n)}))}function movBookmark(e,t){let n="caction=bmmv&folder="+e+"&id="+t,d=new XMLHttpRequest;d.onreadystatechange=function(){if(4==this.readyState&&200==this.status)if(1==this.responseText){let n=document.getElementById(t).parentElement,d=document.getElementById("f_"+e);n.remove(),d.lastChild.appendChild(n)}else{show_noti({title:"Syncmarks - Error",url:"Error moving bookmark",key:""},!1)}},d.open("POST",document.location.href,!0),d.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),d.send(n)}function delClient(e){let t=new XMLHttpRequest,n="caction=adel&cido="+e.target.parentElement.id;t.onreadystatechange=function(){4==t.readyState&&200==t.status&&(document.getElementById("mngcform").innerHTML=t.responseText,document.querySelectorAll("#mngcform li div.remove").forEach((function(e){e.addEventListener("click",delClient,!1)})),document.querySelectorAll("#mngcform li div.rename").forEach((function(e){e.addEventListener("click",mvClient,!1)})))},t.open("POST",document.location.href,!0),t.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),t.send(n)}function mvClient(e){let t=document.createElement("div");t.classList.add("db-spinner"),t.id="db-spinner",document.querySelector("body").appendChild(t);let n=new XMLHttpRequest,d="caction=arename&cido="+e.target.parentElement.id+"&nname="+e.target.parentElement.children[0].children.cname.value;n.onreadystatechange=function(){4==n.readyState&&200==n.status&&(document.getElementById("mngcform").innerHTML=n.responseText,document.querySelectorAll("#mngcform li div.remove").forEach((function(e){e.addEventListener("click",delClient,!1)})),document.querySelectorAll("#mngcform li div.rename").forEach((function(e){e.addEventListener("click",mvClient,!1)})),t.remove())},n.open("POST",document.location.href,!0),n.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),n.send(d)}function resize(e){let t=window.innerWidth-parseInt(e.x);document.getElementById("logfile").style.width=t+"px"}function moveEnd(){let e=document.getElementById("lfiletext");e.scrollTop=e.scrollHeight}function delBookmark(e,t){if(confirm('Would you like to delete "'+t+'"?')){let t=new XMLHttpRequest,n="caction=mdel&id="+e,d=document.createElement("div");d.classList.add("db-spinner"),d.id="db-spinner",document.querySelector("body").appendChild(d),t.onreadystatechange=function(){if(4==this.readyState)if(document.getElementById("db-spinner").remove(),200==this.status)hideMenu(),document.getElementById(e).parentNode.remove();else{show_noti({title:"Syncmarks - Error",url:"There was a problem removing that bookmark.",key:""},!1)}},t.open("POST",document.location.href,!0),t.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),t.send(n)}}function enableSave(){document.getElementById("url").value.length>7?document.getElementById("save").disabled=!1:document.getElementById("save").disabled=!0}function showMenu(e,t){var n=document.querySelector(".menu"),d=window.innerHeight-120;t>=d&&(t=d),n.style.left=e+"px",n.style.top=t+"px",n.style.opacity=1,n.classList.add("show-menu")}function hideMenu(){let e=document.querySelector(".menu");e.classList.remove("show-menu"),e.style.display="none",document.querySelectorAll(".mmenu").forEach((function(e){e.style.display="none"})),document.querySelectorAll(".mbmdialog").forEach((function(e){e.style.display="none"})),document.getElementById("dubDIV")&&document.querySelector("body").removeChild(document.getElementById("dubDIV")),document.getElementById("mnguform")&&document.getElementById("mnguform").remove()}function onContextMenu(e){e.preventDefault(),hideMenu(),document.querySelector(".menu").style.display="block",e.target.attributes.id?(document.getElementById("bmid").value=e.target.attributes.id.value,document.getElementById("bmid").title=e.target.attributes.title.value,document.getElementById("btnMove").setAttribute("style","display:block !important"),document.getElementById("btnFolder").setAttribute("style","display:block !important")):(document.getElementById("bmid").value=e.target.nextElementSibling.value,document.getElementById("bmid").title=e.target.textContent,document.getElementById("btnMove").setAttribute("style","display:none !important"),document.getElementById("btnFolder").setAttribute("style","display:none !important")),showMenu(e.pageX,e.pageY),document.querySelector("#btnEdit").addEventListener("click",onClick,!1),document.querySelector("#btnMove").addEventListener("click",onClick,!1),document.querySelector("#btnDelete").addEventListener("click",onClick,!1),document.querySelector("#btnFolder").addEventListener("click",onClick,!1)}function onClick(e){var t=window.innerHeight-200,n=e.pageX,d=e.pageY;switch(n<=155&&(n=155),d>=t&&(d=t),this.id){case"btnEdit":document.getElementById("edtitle").value=document.getElementById("bmid").title,document.getElementById("edid").value=document.getElementById("bmid").value,document.getElementById(document.getElementById("bmid").value)?(document.getElementById("edurl").value=document.getElementById(document.getElementById("bmid").value).href,document.getElementById("bmarkedt").firstChild.innerText="Edit Bookmark",document.getElementById("edurl").type="text"):(document.getElementById("edurl").value="",document.getElementById("edurl").type="hidden",document.getElementById("bmarkedt").firstChild.innerText="Edit Folder"),hideMenu(),document.getElementById("bmarkedt").style.left=n,document.getElementById("bmarkedt").style.top=d,document.getElementById("bmarkedt").style.display="block";break;case"btnMove":document.getElementById("mvtitle").value=document.getElementById("bmid").title,document.getElementById("mvid").value=document.getElementById("bmid").value,hideMenu(),document.getElementById("bmamove").style.left=n,document.getElementById("bmamove").style.top=d,document.getElementById("bmamove").style.display="block";break;case"btnDelete":delBookmark(document.getElementById("bmid").value,document.getElementById("bmid").title);break;case"btnFolder":hideMenu(),document.getElementById("folderf").style.left=n,document.getElementById("folderf").style.top=d,document.getElementById("folderf").style.display="block",document.getElementById("fbid").value=document.getElementById("bmid").value;break;default:break}document.removeEventListener("click",onClick)}function openMessages(e){var t,n,d;for(n=document.getElementsByClassName("tabcontent"),t=0;t<n.length;t++)n[t].style.display="none";let o=document.querySelector("#"+e.target.dataset.val+" .NotiTable .NotiTableBody");for(;o.firstChild;)o.removeChild(o.lastChild);let i=new XMLHttpRequest,l="caction=rmessage&lp="+e.target.dataset.val;for(i.onreadystatechange=function(){if(4==i.readyState&&200==i.status){const e=(new DOMParser).parseFromString(i.responseText,"text/html");Array.from(e.body.children).forEach((e=>{e.children[1].children[0].addEventListener("click",delMessage,!1),o.appendChild(e)}))}},i.open("POST",document.location.href,!0),i.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),i.send(l),d=document.getElementsByClassName("tablinks"),t=0;t<d.length;t++)d[t].className=d[t].className.replace(" active","");document.getElementById(e.target.dataset.val).style.display="block",e.currentTarget.className+=" active"}function delMessage(e){let t=document.createElement("div");t.classList.add("db-spinner"),t.id="db-spinner",document.querySelector("body").appendChild(t);let n=e.target.parentElement.parentElement.parentElement.parentElement.parentElement.id,d=new XMLHttpRequest,o="caction=rmessage&lp="+n+"&message="+e.target.dataset.message;d.onreadystatechange=function(){4==this.readyState&&200==this.status&&(document.querySelector("#"+n+" .NotiTable .NotiTableBody").innerHTML=this.responseText,document.querySelectorAll(".NotiTableCell .fa-trash").forEach((function(e){e.addEventListener("click",delMessage,!1)})),t.remove())},d.open("POST",document.location.href,!0),d.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),d.send(o)}function eNoti(e){if(e.target.checked)if("Notification"in window)if("granted"===Notification.permission){new Notification("Syncmarks",{body:"Notifications will be enabled for Syncmarks.",icon:"./images/bookmarks192.png"});setOption("notifications",1)}else"denied"!==Notification.permission&&Notification.requestPermission().then((function(e){if("granted"===e){new Notification("Syncmarks",{body:"Notifications will be enabled for Syncmarks.",icon:"./images/bookmarks192.png"});setOption("notifications",1)}}));else alert("This browser does not support desktop notification"),setOption("notifications",0);else setOption("notifications",0)}function setOption(e,t){let n=new XMLHttpRequest,d="caction=soption&option="+e+"&value="+t;n.onreadystatechange=function(){if(4==this.readyState&&200==this.status)if("1"===this.responseText);else{show_noti({title:"Syncmarks - Error",url:"There was a problem, saving the option",key:""},!1)}},n.open("POST",document.location.href,!0),n.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),n.send(d)}function rNot(e){let t=new XMLHttpRequest,n="caction=durl&durl="+e;t.onreadystatechange=function(){if(4==this.readyState&&200==this.status)if("1"===this.responseText);else{show_noti({title:"Syncmarks - Error",url:"Problem removing notification, please check server log.",key:""},!1)}},t.open("POST",document.location.href,!0),t.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),t.send(n)}function show_noti(e,t=!0){if("granted"!==Notification.permission)Notification.requestPermission();else{new Notification(e.title,{body:e.url,icon:"./images/bookmarks192.png",requireInteraction:t}).onclick=function(){e.url.indexOf("http")>=0&&(window.open(e.url),rNot(e.nkey))}}}function getNotifications(){let e=new XMLHttpRequest;e.onreadystatechange=function(){if(4==this.readyState&&200==this.status&&this.responseText){let e=JSON.parse(this.responseText);1==e[0].nOption&&e.forEach((function(e){show_noti(e)}))}},e.open("POST",document.location.href,!0),e.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),e.send("caction=gurls"),sessionStorage.setItem("gNoti","1")}document.addEventListener("DOMContentLoaded",(function(){var e;(document.getElementById("uf")&&document.getElementById("uf").focus(),document.getElementById("loginbody")&&(document.getElementById("hmenu").classList.add("inlogin1"),document.querySelector("#menu button").classList.add("inlogin2")),document.getElementById("bookmarks"))&&(document.querySelector("#menu input").addEventListener("keyup",(function(e){var t=this.value,n=document.querySelectorAll("#bookmarks li.file"),d=document.getElementById("bookmarks");d.innerHTML="",n.forEach((e=>{d.appendChild(e),e.innerText.toUpperCase().includes(t.toUpperCase())||e.firstChild.attributes.href.nodeValue.toUpperCase().includes(t.toUpperCase())?(e.style.display="block",e.style.paddingLeft="20px"):e.style.display="none"})),""!=t&&27!=e.keyCode||(d.innerHTML=document.getElementById("hmarks").innerHTML,document.querySelector("#menu input").value="")})),document.querySelector("#menu button").addEventListener("click",(function(){"×"==document.querySelector("#menu button").innerHTML?(document.querySelector("#menu input").blur(),document.querySelector("#menu button").innerHTML="⌕",document.querySelector("#menu button").classList.remove("asform"),document.querySelector("#menu input").classList.remove("asform"),document.querySelector("#menu input").classList.add("isform"),document.getElementById("mprofile").style.display="block"):(document.querySelector("#menu button").innerHTML="×",document.querySelector("#menu button").classList.add("asform"),document.querySelector("#menu input").classList.remove("isform"),document.querySelector("#menu input").classList.add("asform"),document.getElementById("mprofile").style.display="none",document.querySelector("#menu input").focus()),hideMenu()})),document.getElementById("logfile")&&document.getElementById("logfile").addEventListener("mousedown",(function(e){e.offsetX<3&&document.addEventListener("mousemove",resize,!1)}),!1),document.addEventListener("mouseup",(function(){document.removeEventListener("mousemove",resize,!1)}),!1),document.querySelectorAll(".file").forEach((function(e){e.addEventListener("contextmenu",onContextMenu,!1),e.addEventListener("dragstart",(function(e){e.target.style.opacity=".3",e.dataTransfer.effectAllowed="move"})),e.addEventListener("dragend",(function(e){e.target.style.opacity=""}))})),document.querySelectorAll(".folder").forEach((e=>e.addEventListener("contextmenu",onContextMenu,!1))),document.querySelectorAll(".lbl").forEach((function(t){t.addEventListener("dragover",(function(e){e.preventDefault(),e.dataTransfer.dropEffect="move"})),t.addEventListener("dragenter",(function(){this.style="background-color: lightblue;"})),t.addEventListener("dragleave",(function(){this.style="background-color: unset;"})),t.addEventListener("drop",(function(t){t.preventDefault(),movBookmark(t.target.htmlFor.substring(2),e.target.id),t.target.style="background-color: unset;"}))})),document.addEventListener("drag",(function(t){e=t})),document.querySelectorAll(".tablinks").forEach((e=>e.addEventListener("click",openMessages,!1))),document.querySelectorAll(".NotiTableCell .fa-trash").forEach((e=>e.addEventListener("click",delMessage,!1))),document.querySelector("#cnoti").addEventListener("change",eNoti,!1),1!=sessionStorage.getItem("gNoti")&&getNotifications(),document.addEventListener("keydown",(e=>{"Escape"===e.key&&hideMenu()})),document.querySelector("#mngcform input[type='text']")&&document.querySelector("#mngcform input[type='text']").addEventListener("focus",(function(){this.select()})),document.getElementById("save").addEventListener("click",(function(e){e.preventDefault(),hideMenu();let t=document.getElementById("folder").value,n=encodeURIComponent(document.getElementById("url").value);var d=new XMLHttpRequest,o="caction=madd&folder="+t+"&url="+n;d.onload=function(){if(200==d.status)document.getElementById("bookmarks").innerHTML=this.responseText,document.querySelectorAll(".file").forEach((e=>e.addEventListener("contextmenu",onContextMenu,!1))),document.querySelectorAll(".folder").forEach((e=>e.addEventListener("contextmenu",onContextMenu,!1)));else{show_noti({title:"Syncmarks - Error",url:"Error adding bookmark, please check server log.",key:""},!1)}},d.open("POST",document.location.href,!0),d.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),d.send(o)})),document.getElementById("npwd")&&document.getElementById("npwd").addEventListener("input",(function(){checkuform()})),document.getElementById("nuser")&&document.getElementById("nuser").addEventListener("input",(function(){checkuform()})),document.getElementById("userLevel")&&document.getElementById("userLevel").addEventListener("input",(function(){checkuform()})),document.getElementById("hmenu").addEventListener("click",(function(){var e=document.getElementById("mainmenu");document.querySelector("#bookmarks")&&document.querySelector("#bookmarks").addEventListener("click",hideMenu,!1),"block"===e.style.display?e.style.display="none":(hideMenu(),e.style.display="block")})),document.getElementById("mngusers")&&document.getElementById("mngusers").addEventListener("click",(function(){hideMenu();let e=new XMLHttpRequest;return e.onreadystatechange=function(){if(4==this.readyState&&200==this.status){let t=JSON.parse(e.responseText);if(-1!=t.indexOf("not allowed"))show_noti({title:"Syncmarks - Warning",url:t,key:""},!1);else{document.querySelector("#bookmarks").addEventListener("click",hideMenu,!1);let e=document.createElement("div");e.id="mnguform",e.classList.add("mbmdialog"),e.style.display="block";let n=document.createElement("h6");n.appendChild(document.createTextNode("Manage Users")),e.appendChild(n);let d=document.createElement("select");d.id="userSelect";let o=document.createElement("option");o.text="-- Add new user --",o.value=0,d.appendChild(o),mngUform(t,d);let i=document.createElement("input");i.id="nuser",i.placeholder="Username",i.type="text",i.required=!0,i.autocomplete="username";let l=document.createElement("input");l.id="npwd",l.placeholder="Password",l.type="password",l.autocomplete="password";let a=document.createElement("select");a.id="userLevel";let r=document.createElement("option");r.text="Normal",r.value=1,a.appendChild(r);let c=document.createElement("option");c.text="Admin",c.value=2,a.appendChild(c);let s=document.createElement("div");s.classList.add("dbutton");let u=document.createElement("button");u.id="muadd",u.type="submit",u.disabled=!0,u.innerText="Save";let m=document.createElement("button");m.id="mudel",m.type="submit",m.disabled=!0,m.innerText="Delete",s.appendChild(u),s.appendChild(m),d.addEventListener("change",(function(e){0!=e.target.options[e.target.selectedIndex].value?(i.value=e.target.options[e.target.selectedIndex].text,a.value=e.target.options[e.target.selectedIndex].dataset.lvl,m.disabled=!1):(i.value="",a.value=1,m.disabled=!0)})),i.addEventListener("input",(function(){u.disabled=this.originalValue==this.value&&""==this.value})),l.addEventListener("input",(function(){u.disabled=this.originalValue==this.value&&""==this.value})),a.addEventListener("change",(function(){u.disabled=!1})),e.appendChild(d),e.appendChild(i),e.appendChild(l),e.appendChild(a),e.appendChild(s),document.querySelector("body").appendChild(e),u.addEventListener("click",(function(e){e.preventDefault();let t=document.createElement("div");t.classList.add("db-spinner"),t.id="db-spinner",document.querySelector("body").appendChild(t);let n=new XMLHttpRequest,o="caction=muedt&type="+(0==d.selectedIndex?1:2)+"&p="+l.value+"&userLevel="+a.value+"&nuser="+i.value+"&userSelect="+d.options[d.selectedIndex].value;n.onreadystatechange=function(){if(4==this.readyState&&200==this.status){let e=JSON.parse(n.responseText);-1!=e.indexOf("failed")?show_noti({title:"Syncmarks - Error",url:e,key:""},!1):e.indexOf("not send");let o=new XMLHttpRequest,i="caction=getUsers";o.onreadystatechange=function(){if(4==this.readyState&&200==this.status){t.remove();let e=JSON.parse(o.responseText);-1!=e.indexOf("not allowed")?show_noti({title:"Syncmarks - Warning",url:e,key:""},!1):mngUform(e,d)}},o.open("POST",document.location.href,!0),o.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),o.send(i)}},n.open("POST",document.location.href,!0),n.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),n.send(o)})),m.addEventListener("click",(function(e){e.preventDefault();let t=document.createElement("div");t.classList.add("db-spinner"),t.id="db-spinner",document.querySelector("body").appendChild(t);let n=new XMLHttpRequest,o="caction=muedt&type=3&userLevel="+a.value+"&nuser="+i.value+"&userSelect="+d.options[d.selectedIndex].value;n.onreadystatechange=function(){if(4==this.readyState&&200==this.status){let e=JSON.parse(n.responseText);-1!=e.indexOf("failed")?show_noti({title:"Syncmarks - Error",url:e,key:""},!1):e.indexOf("not send");let o=new XMLHttpRequest,i="caction=getUsers";o.onreadystatechange=function(){if(4==this.readyState&&200==this.status){t.remove();let e=JSON.parse(o.responseText);-1!=e.indexOf("not allowed")?show_noti({title:"Syncmarks - Warning",url:e,key:""},!1):mngUform(e,d)}},o.open("POST",document.location.href,!0),o.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),o.send(i)}},n.open("POST",document.location.href,!0),n.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),n.send(o)}))}}},e.open("POST",document.location.href,!0),e.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),e.send("caction=getUsers"),!1})),document.getElementById("muser").addEventListener("click",(function(e){e.preventDefault(),hideMenu(),document.getElementById("userform").style.display="block",document.querySelector("#bookmarks").addEventListener("click",hideMenu,!1)})),document.getElementById("mmail").addEventListener("click",(function(e){e.preventDefault(),document.getElementById("mailform")&&document.getElementById("mailform").remove(),hideMenu();let t=document.createElement("div");t.id="mailform",t.classList.add("mbmdialog");let n=document.createElement("h6");n.appendChild(document.createTextNode("Change E-Mail"));let d=document.createElement("input");d.id="mput",d.value=document.getElementById("userMail").innerText;let o=document.createElement("div");o.classList.add("dbutton");let i=document.createElement("button");i.id="mchange",i.type="submit",i.disabled=!0,i.innerText="Save",o.appendChild(i),d.addEventListener("input",(function(){i.disabled=this.originalValue==this.value&&""==this.value})),i.addEventListener("click",(function(){let e=new XMLHttpRequest,n="caction=cmail&mail="+d.value;e.onreadystatechange=function(){if(4==this.readyState&&200==this.status){let e=JSON.parse(this.responseText);if(1==e)document.getElementById("userMail").innerText=d.value,t.remove();else{show_noti({title:"Syncmarks - Error",url:e,key:""},!1)}}},e.open("POST",document.location.href,!0),e.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),e.send(n)})),t.appendChild(n),t.appendChild(d),t.appendChild(o),document.querySelector("body").appendChild(t),document.getElementById("mailform").style.display="block",document.querySelector("#bookmarks").addEventListener("click",hideMenu,!1)})),document.querySelectorAll(".mdcancel").forEach((e=>e.addEventListener("click",(function(){hideMenu()})))),document.getElementById("mpassword").addEventListener("click",(function(){hideMenu(),document.getElementById("passwordform").style.display="block",document.querySelector("#bookmarks").addEventListener("click",hideMenu,!1)})),document.getElementById("pbullet").addEventListener("click",(function(){hideMenu(),document.getElementById("pbulletform").style.display="block",document.querySelector("#bookmarks").addEventListener("click",hideMenu,!1)})),document.getElementById("nmessages").addEventListener("click",(function(){hideMenu();let e=new XMLHttpRequest;e.onreadystatechange=function(){if(4==e.readyState&&200==e.status){const t=(new DOMParser).parseFromString(e.responseText,"text/html");let n=document.querySelector("#aNoti .NotiTable .NotiTableBody");Array.from(t.body.children).forEach((e=>{e.children[1].children[0].addEventListener("click",delMessage,!1),n.appendChild(e)}))}},e.open("POST",document.location.href,!0),e.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),e.send("caction=rmessage&lp=aNoti"),document.getElementById("nmessagesform").style.display="block",document.querySelector("#bookmarks").addEventListener("click",hideMenu,!1)})),document.getElementById("clientedt").addEventListener("click",(function(){hideMenu();var e=document.getElementById("mngcform");e.childNodes.length&&e.removeChild(e.firstChild);let t=new XMLHttpRequest;t.onreadystatechange=function(){if(4==t.readyState&&200==t.status){let d=JSON.parse(t.responseText);var n=document.createElement("ul");d.forEach((function(e,t){if("0"!=e.id){let t=document.createElement("li");t.title=e.id,t.dataset.type=e.type.toLowerCase(),t.id=e.id,t.classList="client";let d=document.createElement("div");d.classList="clientname",d.appendChild(document.createTextNode(e.name?e.name:e.id)),t.appendChild(d);let o=document.createElement("input");o.type="text",o.name="cname",o.value=e.name,d.appendChild(o);let i=document.createElement("div");i.classList="lastseen",i.innerText=new Date(parseInt(e.date)).toLocaleString(navigator.language,{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}),d.appendChild(i);let l=document.createElement("div");l.classList="fa-edit rename",l.addEventListener("click",mvClient,!1),t.appendChild(l);let a=document.createElement("div");a.classList="fa-trash remove",a.addEventListener("click",delClient,!1),t.appendChild(a),n.appendChild(t)}})),e.appendChild(n)}},t.open("POST",document.location.href,!0),t.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),t.send("caction=getclients&client=0"),document.getElementById("mngcform").style.display="block",document.querySelector("#bookmarks").addEventListener("click",hideMenu,!1)})),document.getElementById("psettings").addEventListener("click",(function(){hideMenu(),document.getElementById("mngsform").style.display="block",document.querySelector("#bookmarks").addEventListener("click",hideMenu,!1)})),document.getElementById("duplicates").addEventListener("click",(function(){hideMenu();let e=document.createElement("div");e.classList.add("db-spinner"),e.id="db-spinner",document.querySelector("body").appendChild(e);var t=new XMLHttpRequest;return t.onreadystatechange=function(){if(4==this.readyState)if(200==this.status){let t=JSON.parse(this.responseText);if(t.length>0){let n=document.createElement("div"),d=document.createElement("h6");d.innerText=t.length+" duplicates found";let o=document.createElement("span");o.innerText="Click on a entry to delete the duplicate",n.id="dubDIV",n.classList.add("mbmdialog"),n.appendChild(d),n.appendChild(o),document.querySelector("body").appendChild(n);let i=document.createElement("ul");i.id="dubMenu",t.forEach((function(e){let t=document.createElement("ul");t.classList.add("dubSub");let d=document.createElement("li");d.id="dub_"+e.bmID,d.innerText=e.bmTitle,d.dataset.url=e.bmURL,d.title=e.bmURL,e.subs.forEach((function(e){let n=document.createElement("li");n.classList.add("menuitem"),n.innerText=e.bmTitle,n.dataset.bmid=e.bmID,n.addEventListener("click",(function(){let e=new XMLHttpRequest,t=this,n="caction=mdel&rc=1&id="+t.dataset.bmid,d=document.createElement("div");d.classList.add("db-spinner"),d.id="db-spinner",document.querySelector("body").appendChild(d),e.open("POST",document.location.href,!0),e.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),e.addEventListener("load",(function(n){e.status>=200&&e.status<300&&(t.style.display="none",document.getElementById(t.dataset.bmid).parentNode.remove(),document.getElementById("db-spinner").remove())})),e.send(n)}));let d=document.createElement("span");d.innerHTML=e.fway,d.title=d.innerHTML,n.appendChild(d),t.appendChild(n)})),d.appendChild(t),i.appendChild(d),n.appendChild(i),n.style.display="block"})),e.remove()}else e.remove(),show_noti({title:"Syncmarks - Info",url:"No duplicates found",key:""},!1)}else show_noti({title:"Syncmarks - Error",url:"Error checking for duplicates, please check server log.",key:""},!1)},t.open("POST",document.location.href,!0),t.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),t.send("caction=checkdups"),!1})),document.getElementById("bexport").addEventListener("click",(function(){hideMenu();var e=new Date,t=e.getDate(),n=e.getMonth()+1,d=e.getFullYear();t<10&&(t="0"+t),n<10&&(n="0"+n),e=t+"-"+n+"-"+d;var o=new XMLHttpRequest;return o.onreadystatechange=function(){if(4==this.readyState)if(200==this.status){var t=new Blob([this.responseText],{type:"text/html"}),n=document.createElement("a");n.href=window.URL.createObjectURL(t),n.download="bookmarks_"+e+".html",n.click()}else{show_noti({title:"Syncmarks - Error",url:"Error generating export, please check server log.",key:""},!1)}},o.open("POST",document.location.href,!0),o.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),o.send("caction=export&type=html"),!1})),document.getElementById("footer").addEventListener("click",(function(){hideMenu(),document.querySelector("#bookmarks").addEventListener("click",hideMenu,!1),document.getElementById("bmarkadd").style.display="block",url.focus(),url.addEventListener("input",enableSave)})),document.getElementById("mlog")&&document.getElementById("mlog").addEventListener("click",(function(){hideMenu();let e=document.getElementById("logfile");if("visible"===e.style.visibility)e.style.visibility="hidden",document.getElementById("close").style.visibility="hidden";else{e.style.visibility="visible",document.getElementById("close").style.visibility="visible";let t=new XMLHttpRequest,n="caction=mlog";t.onreadystatechange=function(){if(4==this.readyState)if(200==this.status)document.getElementById("lfiletext").innerText=this.responseText,moveEnd();else{show_noti({title:"Syncmarks - Error",url:"Error loading logfile, please check server log.",key:""},!1)}},t.open("POST",document.location.href,!0),t.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),t.send(n)}})),document.getElementById("mclear")&&document.getElementById("mclear").addEventListener("click",(function(){let e=document.getElementById("logfile");if("visible"===e.style.visibility){e.style.visibility="hidden",document.getElementById("close").style.visibility="hidden";let t=new XMLHttpRequest,n="caction=mclear";t.onreadystatechange=function(){if(4==this.readyState)if(200==this.status);else{show_noti({title:"Syncmarks - Error",url:"Error couldnt clear logfile.",key:""},!1)}},t.open("POST",document.location.href,!0),t.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),t.send(n)}})),document.getElementById("mclose")&&document.getElementById("mclose").addEventListener("click",(function(){"visible"===document.getElementById("logfile").style.visibility&&(document.getElementById("logfile").style.visibility="hidden",document.getElementById("close").style.visibility="hidden")})),document.querySelectorAll("#mngcform .clientname").forEach((function(e){e.addEventListener("touchstart",(function(){this.children[0].style.display="block"}))})),document.querySelectorAll("#mngcform li div.clientname input").forEach((function(e){e.addEventListener("mouseleave",(function(){this.defaultValue!=this.value&&(this.style.display="block",this.parentElement.parentElement.children[2].classList.add("renamea"),this.parentElement.parentElement.children[1].classList.add("renamea"),this.parentElement.parentElement.children[1].classList.remove("rename"),this.parentElement.parentElement.children[2].classList.remove("remove"))}))})),document.getElementById("fname").addEventListener("input",(function(){document.getElementById("fsave").disabled=!1})),document.getElementById("edtitle").addEventListener("input",(function(){document.getElementById("edsave").disabled=!1})),document.getElementById("edurl").addEventListener("input",(function(){document.getElementById("edsave").disabled=!1})),document.getElementById("mvfolder").addEventListener("change",(function(){document.getElementById("mvsave").disabled=!1})),document.getElementById("fsave").addEventListener("click",(function(e){e.preventDefault();let t=new XMLHttpRequest,n="caction=cfolder&fname="+document.getElementById("fname").value+"&fbid="+document.getElementById("fbid").value;return t.onreadystatechange=function(){if(4==this.readyState&&200==this.status)if(1==this.responseText)location.href=location.href;else{show_noti({title:"Syncmarks - Error",url:"There was a problem adding the new folder.",key:""},!1)}},t.open("POST",document.location.href,!0),t.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),t.send(n),hideMenu(),!1})),document.getElementById("edsave").addEventListener("click",(function(e){e.preventDefault();let t=new XMLHttpRequest,n="caction=bmedt&title="+document.getElementById("edtitle").value+"&url="+document.getElementById("edurl").value+"&id="+document.getElementById("edid").value;return t.onreadystatechange=function(){if(4==this.readyState&&200==this.status)if(1==this.responseText)location.reload();else{show_noti({title:"Syncmarks - Error",url:"There was a problem changing that bookmark.",key:""},!1)}},t.open("POST",document.location.href,!0),t.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),t.send(n),!1})),document.getElementById("mvsave").addEventListener("click",(function(e){e.preventDefault(),movBookmark(document.getElementById("mvfolder").value,document.getElementById("mvid").value),document.getElementById("bmamove").style.display="none"})))}),!1);