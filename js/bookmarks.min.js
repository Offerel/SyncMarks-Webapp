function addBookmarkEvents(){var e;document.addEventListener("mouseup",function(){document.removeEventListener("mousemove",resize,!1)},!1),document.querySelectorAll(".file").forEach(function(e){e.addEventListener("contextmenu",onContextMenu,!1),e.addEventListener("mouseup",clicCheck,!1),e.addEventListener("dragstart",function(e){e.target.style.opacity=".3",e.dataTransfer.effectAllowed="move"}),e.addEventListener("dragend",function(e){e.target.style.opacity=""})}),document.querySelectorAll(".folder").forEach(e=>e.addEventListener("mouseup",clicCheck,!1)),document.querySelectorAll(".folder").forEach(e=>e.addEventListener("contextmenu",onContextMenu,!1)),document.querySelectorAll(".lbl").forEach(function(t){t.addEventListener("mouseup",openFolderBookmarks,!1),t.addEventListener("dragover",function(e){e.preventDefault(),e.dataTransfer.dropEffect="move"}),t.addEventListener("dragenter",function(){this.style="background-color: lightblue;"}),t.addEventListener("dragleave",function(){this.style="background-color: unset;"}),t.addEventListener("drop",function(t){t.preventDefault();let n=t.target.htmlFor.substring(2);0===bmIDs.length&&bmIDs.push(e.target.id),bmIDs.forEach(e=>sendRequest(bmmv,n,e)),t.target.style="background-color: unset;"})}),document.addEventListener("drag",function(t){e=t}),document.getElementById("bookmarks").addEventListener("keyup",rmBm),document.querySelectorAll(".file").forEach(e=>e.addEventListener("contextmenu",onContextMenu,!1)),document.querySelectorAll(".file").forEach(e=>e.addEventListener("mouseup",clicCheck,!1)),document.querySelectorAll(".folder").forEach(e=>e.addEventListener("mouseup",clicCheck,!1)),document.querySelectorAll(".folder").forEach(e=>e.addEventListener("contextmenu",onContextMenu,!1))}function clicCheck(e){let t=this.children[0];switch(e.button){case 0:e.ctrlKey?t.classList.contains("bmMarked")?(-1!==bmIDs.indexOf(t.id)&&bmIDs.splice(bmIDs.indexOf(t.id),1),t.classList.remove("bmMarked")):(t.classList.add("bmMarked"),bmIDs.push(t.id)):void 0!==e.srcElement.dataset.url&&window.open(e.srcElement.dataset.url,"_blank","noopener,noreferrer");break;case 1:void 0!==e.srcElement.dataset.url&&window.open(e.srcElement.dataset.url,"_blank","noopener,noreferrer")}}function addBD(){menubg=document.getElementById("mnubg"),menubg.style.visibility="visible",document.getElementById("mnubg").style.visibility="visible"}function openFolderBookmarks(e){if(e.ctrlKey&&0==e.button||1==e.button){this.htmlFor.substring(2);let e=this.parentElement.children[2].childNodes;e.forEach(function(e){if(null!=e.className&&e.className.indexOf("file")>-1){let t=e.children[0];t.click()}})}}function rmBm(e){if(46==e.keyCode&&confirm("Would you like to delete these "+bmIDs.length+" marked bookmarks?")){sendRequest(mdel,JSON.stringify(bmIDs));let e=document.createElement("div");e.classList.add("db-spinner"),e.id="db-spinner",document.querySelector("body").appendChild(e)}}function sendRequest(e,t=null,n=null){const d={action:e.name,client:0,data:t,add:n,sync:null},o=new XMLHttpRequest;o.open("POST",document.location.href,!0),o.setRequestHeader("Content-type","application/x-www-form-urlencoded"),o.responseType="json",o.onreadystatechange=function(){if(4===o.readyState)if(200===o.status)e(o.response,n);else{let t=`Error ${o.status}: ${o.statusText}`;console.warn(e.name,t),pwaMessage(e.name+": "+t,"error")}},o.onerror=function(){let t="Error: "+o.status+" | "+o.response;return console.warn(e.name,url,t),!1};const l=new URLSearchParams(d);o.send(l)}function pwaMessage(e,t){var n=document.getElementById("pwamessage");return n.classList.add(t),n.innerText=e,n.classList.add("show"),setTimeout(function(){n.className=n.classList.remove("show")},1e4),!1}function getclients(e){let t=e;var n=document.getElementById("mngcform");n.childNodes.length&&n.removeChild(n.firstChild);var d=document.createElement("ul");t.forEach(function(e,t){if("0"!=e.id){let t=document.createElement("li");t.title=e.id,t.dataset.type=e.type.toLowerCase(),t.id=e.id,t.classList="client";let n=document.createElement("div");n.classList="clientname",n.appendChild(document.createTextNode(e.name?e.name:e.id)),t.appendChild(n);let o=document.createElement("input");o.type="text",o.name="cname",o.value=e.name,n.appendChild(o);let l=document.createElement("div");l.classList="lastseen",l.innerText="0"!=e.date?"Sync: "+new Date(parseInt(e.date)).toLocaleString(navigator.language,{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"Sync: -- -- ---- -- --",n.appendChild(l);let i=document.createElement("div");i.classList="fa-edit rename",i.addEventListener("click",mvClient,!1),t.appendChild(i);let r=document.createElement("div");r.classList="fa-trash remove",r.addEventListener("click",delClient,!1),t.appendChild(r),d.appendChild(t)}}),n.appendChild(d),addBD(),document.getElementById("mngcform").style.display="block",document.querySelector("#bookmarks").addEventListener("click",hideMenu,!1)}function addmark(e){let t="Bookmark added successfully.";"Bookmark not added"==e?t="Bookmark not added":(document.getElementById("bookmarks").innerHTML=e,document.querySelectorAll(".file").forEach(e=>e.addEventListener("contextmenu",onContextMenu,!1)),document.querySelectorAll(".file").forEach(e=>e.addEventListener("mouseup",clicCheck,!1)),document.querySelectorAll(".folder").forEach(e=>e.addEventListener("mouseup",clicCheck,!1)),document.querySelectorAll(".folder").forEach(e=>e.addEventListener("contextmenu",onContextMenu,!1))),console.info(t);let n=t.includes("not")?"warn":"success";pwaMessage(t,n)}function muedt(e){document.getElementById("db-spinner")&&document.getElementById("db-spinner").remove(),-1!=e.indexOf("failed")?(console.error("Syncmarks: "+e),show_noti({title:"Syncmarks - Error",url:e,key:""},!1)):-1!=e.indexOf("not send")&&(console.warn("Syncmarks: "+e),pwaMessage(e,"error")),sendRequest(getUsers)}function getUsers(e){let t=e;if(-1!=t.indexOf("not allowed"))console.warn("SyncMarks - Warning: "+t),show_noti({title:"Syncmarks - Warning",url:t,key:""},!1);else{document.getElementById("mnguform")&&document.getElementById("mnguform").remove(),document.querySelector("#bookmarks").addEventListener("click",hideMenu,!1);let e=document.createElement("div");e.id="mnguform",e.classList.add("mbmdialog"),e.style.display="block";let n=document.createElement("h6");n.appendChild(document.createTextNode("Manage Users")),e.appendChild(n);let d=document.createElement("select");d.id="userSelect";let o=document.createElement("option");o.text="-- Add new user --",o.value=0,d.appendChild(o),mngUform(t,d);let l=document.createElement("input");l.id="nuser",l.placeholder="E-Mail",l.type="text",l.required=!0,l.autocomplete="username";let i=document.createElement("input");i.id="npwd",i.placeholder="Password",i.type="password",i.autocomplete="password";let r=document.createElement("select");r.id="userLevel";let c=document.createElement("option");c.text="Normal",c.value=1,r.appendChild(c);let s=document.createElement("option");s.text="Admin",s.value=2,r.appendChild(s);let a=document.createElement("div");a.classList.add("dbutton");let m=document.createElement("button");m.id="muadd",m.type="submit",m.disabled=!0,m.innerText="Save";let u=document.createElement("button");u.id="mudel",u.type="submit",u.disabled=!0,u.innerText="Delete",a.appendChild(m),a.appendChild(u),d.addEventListener("change",function(e){0!=e.target.options[e.target.selectedIndex].value?(l.value=e.target.options[e.target.selectedIndex].text,r.value=e.target.options[e.target.selectedIndex].dataset.lvl,u.disabled=!1):(l.value="",r.value=1,u.disabled=!0)}),l.addEventListener("input",function(){m.disabled=this.originalValue==this.value&&""==this.value}),i.addEventListener("input",function(){m.disabled=this.originalValue==this.value&&""==this.value}),r.addEventListener("change",function(){m.disabled=!1}),e.appendChild(d),e.appendChild(l),e.appendChild(i),e.appendChild(r),e.appendChild(a),addBD(),document.querySelector("body").appendChild(e),m.addEventListener("click",function(e){e.preventDefault();let t=document.createElement("div");t.classList.add("db-spinner"),t.id="db-spinner",document.querySelector("body").appendChild(t);let n=0==d.selectedIndex?1:2,o=JSON.stringify({type:n,p:i.value,userLevel:r.value,nuser:l.value,userSelect:d.options[d.selectedIndex].value});sendRequest(muedt,o)}),u.addEventListener("click",function(e){e.preventDefault();let t=document.createElement("div");t.classList.add("db-spinner"),t.id="db-spinner",document.querySelector("body").appendChild(t);let n=JSON.stringify({type:3,userLevel:r.value,nuser:l.value,userSelect:d.options[d.selectedIndex].value});sendRequest(muedt,n)})}return!1}function cmail(e){if(1==e)document.getElementById("userMail").innerText=mput.value,console.info("Mail changed."),mailform.remove();else{let t=e;console.error(t),show_noti({title:"Syncmarks - Error",url:t,key:""},!1),pwaMessage(t,"error")}}function checkdups(e){let t=e;if(t.length>0){let e=document.createElement("div"),n=document.createElement("h6");n.innerText=t.length+" duplicates found";let d=document.createElement("span");d.innerText="Click on a entry to delete the duplicate",e.id="dubDIV",e.classList.add("mbmdialog"),e.appendChild(n),e.appendChild(d),document.querySelector("body").appendChild(e);let o=document.createElement("ul");o.id="dubMenu",t.forEach(function(t){let n=document.createElement("ul");n.classList.add("dubSub");let d=document.createElement("li");d.id="dub_"+t.bmID,d.innerText=t.bmTitle,d.dataset.url=t.bmURL,d.title=t.bmURL,t.subs.forEach(function(e){let t=document.createElement("li");t.classList.add("menuitem"),t.innerText=e.bmTitle,t.dataset.bmid=e.bmID,t.addEventListener("click",function(){let e=this;sendRequest(mdel,JSON.stringify([e.dataset.bmid]),1);let t=document.createElement("div");t.classList.add("db-spinner"),t.id="db-spinner",document.querySelector("body").appendChild(t)});let d=document.createElement("span");d.innerHTML=e.fway,d.title=d.innerHTML,t.appendChild(d),n.appendChild(t)}),d.appendChild(n),o.appendChild(d),e.appendChild(o),addBD(),e.style.display="block"}),document.getElementById("db-spinner")&&document.getElementById("db-spinner").remove()}else document.getElementById("db-spinner")&&document.getElementById("db-spinner").remove(),console.info("No duplicates found"),show_noti({title:"Syncmarks - Info",url:"No duplicates found",key:""},!1),pwaMessage("No duplicates found","warn")}function logRefresh(){let e=document.getElementById("arefresh").checked,t=document.getElementById("logfile");"visible"===t.style.visibility&&sendRequest(mrefresh),!0===e&&setTimeout(logRefresh,3e4)}function rmessage(e,t="aNoti"){let n="#"+t,d=(new DOMParser).parseFromString(e,"text/html"),o=document.querySelector(n+" .NotiTable .NotiTableBody");for(;o.firstChild;)o.removeChild(o.lastChild);Array.from(d.body.children).forEach(e=>{e.children[1].children[0].addEventListener("click",delMessage,!1),o.appendChild(e)}),addBD(),document.getElementById("nmessagesform").style.display="block",document.querySelector("#bookmarks").addEventListener("click",hideMenu,!1),document.getElementById("db-spinner")&&document.getElementById("db-spinner").remove()}function bexport(e){let t=new Date,n=t.getDate(),d=t.getMonth()+1;n<10&&(n="0"+n),d<10&&(d="0"+d),t=n+"-"+d+"-"+t.getFullYear();let o=new Blob([e],{type:"text/html"}),l=document.createElement("a");l.href=window.URL.createObjectURL(o),l.download="bookmarks_"+t+".html",l.click(),console.info("HTML export successfully, please look in your download folder."),pwaMessage("HTML export successfully, please look in your download folder.","success")}function mlog(e){const t=document.getElementById("lfiletext");for(;t.firstChild;)t.firstChild.remove();let n=e.split("\n");n.forEach(function(e){let n=document.createElement("span");e.indexOf("debug")>0?n.classList.add("debug"):e.indexOf("notice")>0?n.classList.add("notice"):e.indexOf("warn")>0?n.classList.add("warn"):e.indexOf("error")>0&&n.classList.add("error"),n.innerText=e,t.appendChild(n)}),moveEnd()}function mclear(e){const t=document.getElementById("lfiletext");for(;t.firstChild;)t.firstChild.remove();let n=e.split("\n");n.forEach(function(e){let n=document.createElement("span");e.indexOf("debug")>0?n.classList.add("debug"):e.indexOf("notice")>0?n.classList.add("notice"):e.indexOf("warn")>0?n.classList.add("warn"):e.indexOf("error")>0&&n.classList.add("error"),n.innerText=e,t.appendChild(n)}),moveEnd(),console.info("Logfile should now be empty.")}function mrefresh(e){const t=document.getElementById("lfiletext");for(;t.firstChild;)t.firstChild.remove();let n=e.split("\n");n.forEach(function(e){let n=document.createElement("span");e.indexOf("debug")>0?n.classList.add("debug"):e.indexOf("notice")>0?n.classList.add("notice"):e.indexOf("warn")>0?n.classList.add("warn"):e.indexOf("error")>0&&n.classList.add("error"),n.innerText=e,t.appendChild(n)}),moveEnd()}function cfolder(e){if(1==e)location.href=location.href;else{let e="There was a problem adding the new folder.";console.error(e),show_noti({title:"Syncmarks - Error",url:e,key:""},!1),pwaMessage(e,"error")}hideMenu()}function bmedt(e){if(1==e)location.reload();else{let e="There was a problem changing that bookmark.";console.error(e),show_noti({title:"Syncmarks - Error",url:e,key:""},!1),pwaMessage(e,"error")}}function bmmv(e){if(!1!==e){let t=document.getElementById(e.id).parentElement,n=document.getElementById("f_"+e.folder);t.remove(),n.lastChild.appendChild(t),t.children[0].classList.remove("bmMarked"),bmIDs.shift()}else{let e="Error moving bookmark";show_noti({title:"Syncmarks - Error",url:e,key:""},!1),console.error(e),pwaMessage(e,"error")}}function adel(e){document.getElementById("mngcform").innerHTML=e,document.querySelectorAll("#mngcform li div.remove").forEach(function(e){e.addEventListener("click",delClient,!1)}),document.querySelectorAll("#mngcform li div.rename").forEach(function(e){e.addEventListener("click",mvClient,!1)})}function arename(e){document.getElementById("mngcform").innerHTML=e,document.querySelectorAll("#mngcform li div.remove").forEach(function(e){e.addEventListener("click",delClient,!1)}),document.querySelectorAll("#mngcform li div.rename").forEach(function(e){e.addEventListener("click",mvClient,!1)}),document.getElementById("db-spinner")&&document.getElementById("db-spinner").remove()}function mdel(e){hideMenu(),document.getElementById("db-spinner")&&document.getElementById("db-spinner").remove(),Array.isArray(e)?e.forEach(function(e){document.getElementById(e).parentNode.remove()}):(show_noti({title:"Syncmarks - Error",url:e,key:""},!1),console.error(e),pwaMessage(e,"error"))}function soption(e){if("true"==e)console.info("Option saved."),pwaMessage("Option saved.","success");else{let e="There was a problem, saving the option";show_noti({title:"Syncmarks - Error",url:e,key:""},!1),console.error(e),pwaMessage(e,"error")}}function durl(e){if("1"==e)console.info("Notification removed");else{let e="Problem removing notification, please check server log.";console.error(e),show_noti({title:"Syncmarks - Error",url:e,key:""},!1),pwaMessage(e,"error")}}function gurls(e){let t=e;Object.keys(t).length>0&&1==t[0].nOption&&t.forEach(function(e){show_noti(e)}),sessionStorage.setItem("gNoti","1"),navigator.serviceWorker.controller.postMessage({type:"checkIDB"})}function mngUform(e,t){t.options.length=1,e.forEach(function(e){let n=document.createElement("option");n.text=e.userName,n.value=e.userID,n.dataset.lvl=e.userType,t.appendChild(n)})}function delClient(e){sendRequest(adel,e.target.parentElement.id)}function mvClient(e){let t=document.createElement("div");t.classList.add("db-spinner"),t.id="db-spinner",document.querySelector("body").appendChild(t),sendRequest(arename,e.target.parentElement.children[0].children.cname.value,e.target.parentElement.id)}function resize(e){let t=window.innerWidth-parseInt(e.x);document.getElementById("logfile").style.width=t+"px"}function moveEnd(){let e=document.getElementById("lfiletext");e.scrollTop=e.scrollHeight}function delBookmark(e,t){if(confirm('Would you like to delete "'+t+'"?')){const t=[e];sendRequest(mdel,JSON.stringify(t));let n=document.createElement("div");n.classList.add("db-spinner"),n.id="db-spinner",document.querySelector("body").appendChild(n)}}function enableSave(){document.getElementById("url").value.length>7?document.getElementById("save").disabled=!1:document.getElementById("save").disabled=!0}function showMenu(e,t){var n=document.querySelector(".menu"),d=window.innerHeight-120;return t>=d&&(t=d),n.style.left=e+"px",n.style.top=t+"px",n.style.visibility="visible",addBD(),!1}function hideMenu(){let e=document.querySelector(".menu");e.classList.remove("show-menu"),e.style.display="none",document.querySelectorAll(".mmenu").forEach(function(e){e.style.display="none"}),document.querySelectorAll(".mbmdialog").forEach(function(e){e.style.display="none"}),document.getElementById("mnubg").style.visibility="hidden",document.getElementById("dubDIV")&&document.querySelector("body").removeChild(document.getElementById("dubDIV")),document.getElementById("mnguform")&&document.getElementById("mnguform").remove();let t=document.querySelectorAll(".bmMarked");for(let e=0;e<t.length;e++)t[e].classList.remove("bmMarked");bmIDs.length=0}function onContextMenu(e){e.preventDefault(),e.stopPropagation(),e.cancelBubble=!0,e.returnValue=!1,hideMenu();let t=document.querySelector(".menu");return t.style.display="block",e.target.attributes.id?(document.getElementById("bmid").value=e.target.attributes.id.value,document.getElementById("bmid").title=e.target.attributes.title.value,document.getElementById("btnMove").setAttribute("style","display:block !important"),document.getElementById("btnFolder").setAttribute("style","display:block !important")):(document.getElementById("bmid").value=e.target.nextElementSibling.value,document.getElementById("bmid").title=e.target.textContent,document.getElementById("btnMove").setAttribute("style","display:none !important"),document.getElementById("btnFolder").setAttribute("style","display:none !important")),document.querySelector("#btnEdit").addEventListener("click",onMenuClick,!1),document.querySelector("#btnMove").addEventListener("click",onMenuClick,!1),document.querySelector("#btnDelete").addEventListener("click",onMenuClick,!1),document.querySelector("#btnFolder").addEventListener("click",onMenuClick,!1),showMenu(e.pageX,e.pageY),!1}function onMenuClick(e){var t=155,n=window.innerHeight-200,d=e.pageX,o=e.pageY;switch(d<=t&&(d=t),o>=n&&(o=n),addBD(),this.id){case"btnEdit":document.getElementById("edtitle").value=document.getElementById("bmid").title,document.getElementById("edid").value=document.getElementById("bmid").value,document.getElementById(document.getElementById("bmid").value)?(document.getElementById("edurl").value=document.getElementById(document.getElementById("bmid").value).dataset.url,document.getElementById("bmarkedt").firstChild.innerText="Edit Bookmark",document.getElementById("edurl").type="text"):(document.getElementById("edurl").value="",document.getElementById("edurl").type="hidden",document.getElementById("bmarkedt").firstChild.innerText="Edit Folder"),hideMenu(),document.getElementById("bmarkedt").style.left=d,document.getElementById("bmarkedt").style.top=o,document.getElementById("bmarkedt").style.display="block",document.getElementById("edtitle").focus();break;case"btnMove":document.getElementById("mvtitle").value=document.getElementById("bmid").title,document.getElementById("mvid").value=document.getElementById("bmid").value,hideMenu(),document.getElementById("bmamove").style.left=d,document.getElementById("bmamove").style.top=o,document.getElementById("bmamove").style.display="block";break;case"btnDelete":hideMenu(),setTimeout(delBookmark,5,document.getElementById("bmid").value,document.getElementById("bmid").title);break;case"btnFolder":hideMenu(),document.getElementById("folderf").style.left=d,document.getElementById("folderf").style.top=o,document.getElementById("folderf").style.display="block",document.getElementById("fbid").value=document.getElementById("bmid").value,document.getElementById("fname").focus()}document.removeEventListener("click",onMenuClick)}function openMessages(e){var t,n,d;for(n=document.getElementsByClassName("tabcontent"),t=0;t<n.length;t++)n[t].style.display="none";let o=document.querySelector("#"+e.target.dataset.val+" .NotiTable .NotiTableBody");for(;o.firstChild;)o.removeChild(o.lastChild);let l=document.createElement("div");for(l.classList.add("db-spinner"),l.id="db-spinner",document.querySelector("body").appendChild(l),sendRequest(rmessage,null,e.target.dataset.val),d=document.getElementsByClassName("tablinks"),t=0;t<d.length;t++)d[t].className=d[t].className.replace(" active","");document.getElementById(e.target.dataset.val).style.display="block",e.currentTarget.className+=" active"}function delMessage(e){let t=document.createElement("div");t.classList.add("db-spinner"),t.id="db-spinner",document.querySelector("body").appendChild(t),sendRequest(rmessage,e.target.dataset.message,e.target.parentElement.parentElement.parentElement.parentElement.parentElement.id)}function eNoti(e){var t=e.target.checked;if(t)if("Notification"in window)if("granted"===Notification.permission){new Notification("Syncmarks",{body:"Notifications will be enabled for Syncmarks.",icon:"./images/bookmarks192.png"});sendRequest(soption,"notifications",1)}else"denied"!==Notification.permission&&Notification.requestPermission().then(function(e){if("granted"===e){new Notification("Syncmarks",{body:"Notifications will be enabled for Syncmarks.",icon:"./images/bookmarks192.png"});sendRequest(soption,"notifications",1)}});else alert("This browser does not support desktop notification"),sendRequest(soption,"notifications",0);else sendRequest(soption,"notifications",0)}function show_noti(e,t=!0){if("granted"!==Notification.permission)Notification.requestPermission();else{let n=new Notification(e.title,{body:e.url,icon:"./images/bookmarks192.png",requireInteraction:t});n.onclick=function(){e.url.indexOf("http")>=0&&(window.open(e.url),sendRequest(durl,e.nkey))}}}const dbName="syncmarks",dbStoreName="bookmarks";let db,dbRequest=indexedDB.open(dbName);document.addEventListener("DOMContentLoaded",function(){if("serviceWorker"in navigator)try{navigator.serviceWorker.register("smsw.js")}catch(e){console.error(`ServiceWorker registration failed with ${e}`),pwaMessage(`ServiceWorker registration failed with ${e}`,"error")}navigator.serviceWorker.addEventListener("message",e=>{if(e.data&&"openDialog"===e.data.type&&(document.getElementById("bmarkadd").style.display="block",document.getElementById("url").value=e.data.data),e.data.addbm)return document.getElementById("footer").click(),!1;if(e.data.sharemark)return sendRequest(addmark,e.data.sharemark,2),sessionStorage.setItem("gNoti",1),!1;if(e.data.delmsaved)return sendRequest(mdel,e.data.delmsaved),!1;if(e.data.bookmarksAddedDB&&console.log("Bookmarks saved"),e.data.clientOffline){document.getElementById("db-spinner")&&document.getElementById("db-spinner").remove(),console.warn(e.data.clientOffline),pwaMessage(e.data.clientOffline,"warn");let t=indexedDB.open(dbName);t.onsuccess=(e=>{let t=e.target.result;const n=t.transaction(dbStoreName,"readwrite"),d=n.objectStore(dbStoreName),o=d.get("bookmarks");o.onsuccess=function(e){document.getElementById("bookmarks").innerHTML=o.result,document.getElementById("hmarks").innerHTML=o.result,addBookmarkEvents()}})}}),navigator.serviceWorker.addEventListener("controllerchange",e=>{}),document.getElementById("preset")&&document.getElementById("preset").addEventListener("click",function(e){e.preventDefault();let t="reset=request&u="+e.target.dataset.reset,n=location.protocol+"//"+location.host+location.pathname;xhr.open("GET",n+"?"+t,!0),xhr.onreadystatechange=function(){if(4==this.readyState&&200==this.status&&1==JSON.parse(this.responseText)){let e=document.getElementById("loginformt");e.classList.toggle("info"),e.innerText="Password request confirmation is send to your E-Mail. Request is valid for 5 minutes."}},xhr.send(null)}),document.getElementById("uf")&&document.getElementById("uf").focus(),document.getElementById("loginbody")&&(document.getElementById("hmenu").classList.add("inlogin1"),document.querySelector("#menu button").classList.add("inlogin2")),document.getElementById("bookmarks")&&(document.querySelector("#menu input").addEventListener("keyup",function(e){var t=this.value,n=document.querySelectorAll("#bookmarks li.file"),d=document.getElementById("bookmarks");d.innerHTML="",n.forEach(e=>{d.appendChild(e),e.innerText.toUpperCase().includes(t.toUpperCase())||e.firstChild.dataset.url.toUpperCase().includes(t.toUpperCase())?(e.style.display="block",e.style.paddingLeft="20px"):e.style.display="none"}),""!=t&&27!=e.keyCode||(d.innerHTML=document.getElementById("hmarks").innerHTML,document.querySelector("#menu input").value="")}),document.querySelector("#menu button").addEventListener("click",function(){"×"==document.querySelector("#menu button").innerHTML?(document.querySelector("#menu input").blur(),document.querySelector("#menu button").innerHTML="⌕",document.querySelector("#menu button").classList.remove("asform"),document.querySelector("#menu input").classList.remove("asform"),document.querySelector("#menu input").classList.add("isform"),document.getElementById("mprofile").style.display="block"):(document.querySelector("#menu button").innerHTML="×",document.querySelector("#menu button").classList.add("asform"),document.querySelector("#menu input").classList.remove("isform"),document.querySelector("#menu input").classList.add("asform"),document.getElementById("mprofile").style.display="none",document.querySelector("#menu input").focus()),document.querySelector("#menu input").value="",hideMenu()}),document.getElementById("mprofile").addEventListener("click",function(){document.querySelector("#menu input").value="","×"==document.querySelector("#menu button").innerHTML?(document.querySelector("#menu input").blur(),document.querySelector("#menu button").innerHTML="⌕",document.querySelector("#menu button").classList.remove("asform"),document.querySelector("#menu input").classList.remove("asform"),document.querySelector("#menu input").classList.add("isform"),document.getElementById("mprofile").style.display="block"):(document.querySelector("#menu button").innerHTML="×",document.querySelector("#menu button").classList.add("asform"),document.querySelector("#menu input").classList.remove("isform"),document.querySelector("#menu input").classList.add("asform"),document.getElementById("mprofile").style.display="none",document.querySelector("#menu input").focus()),hideMenu()}),document.getElementById("bmsearch").addEventListener("keydown",function(e){"Escape"===e.key&&(document.querySelector("#menu input").blur(),document.querySelector("#menu button").innerHTML="⌕",document.querySelector("#menu button").classList.remove("asform"),document.querySelector("#menu input").classList.remove("asform"),document.querySelector("#menu input").classList.add("isform"),document.getElementById("mprofile").style.display="block",document.getElementById("bookmarks").innerHTML=document.getElementById("hmarks").innerHTML)}),document.getElementById("logfile")&&document.getElementById("logfile").addEventListener("mousedown",function(e){e.offsetX<3&&document.addEventListener("mousemove",resize,!1)},!1),document.querySelectorAll(".tablinks").forEach(e=>e.addEventListener("click",openMessages,!1)),document.querySelectorAll(".NotiTableCell .fa-trash").forEach(e=>e.addEventListener("click",delMessage,!1)),document.querySelector("#cnoti").addEventListener("change",eNoti,!1),1!=sessionStorage.getItem("gNoti")&&sendRequest(gurls),document.addEventListener("keydown",e=>{"Escape"===e.key&&hideMenu()}),document.querySelector("#mngcform input[type='text']")&&document.querySelector("#mngcform input[type='text']").addEventListener("focus",function(){this.select()}),document.getElementById("save").addEventListener("click",function(e){e.preventDefault(),hideMenu();let t=JSON.stringify({id:Math.random().toString(24).substring(2,14),url:document.getElementById("url").value,title:"",type:"bookmark",folder:document.getElementById("folder").value,nfolder:"More Bookmarks",added:(new Date).valueOf()});sendRequest(addmark,t,2)}),document.getElementById("npwd")&&document.getElementById("npwd").addEventListener("input",function(){checkuform()}),document.getElementById("nuser")&&document.getElementById("nuser").addEventListener("input",function(){checkuform()}),document.getElementById("userLevel")&&document.getElementById("userLevel").addEventListener("input",function(){checkuform()}),document.getElementById("hmenu").addEventListener("click",function(){var e=document.getElementById("mainmenu");document.querySelector("#bookmarks")&&document.querySelector("#bookmarks").addEventListener("click",hideMenu,!1),"block"===e.style.display?e.style.display="none":(hideMenu(),addBD(),e.style.display="block")}),document.getElementById("mngusers")&&document.getElementById("mngusers").addEventListener("click",function(){hideMenu(),sendRequest(getUsers)}),document.getElementById("muser").addEventListener("click",function(e){e.preventDefault(),hideMenu(),addBD(),document.getElementById("userform").style.display="block",document.querySelector("#bookmarks").addEventListener("click",hideMenu,!1)}),document.getElementById("mmail").addEventListener("click",function(e){e.preventDefault(),document.getElementById("mailform")&&document.getElementById("mailform").remove(),hideMenu();let t=document.createElement("div");t.id="mailform",t.classList.add("mbmdialog");let n=document.createElement("h6");n.appendChild(document.createTextNode("Change E-Mail"));let d=document.createElement("input");d.id="mput",d.value=document.getElementById("userMail").innerText;let o=document.createElement("div");o.classList.add("dbutton");let l=document.createElement("button");l.id="mchange",l.type="submit",l.disabled=!0,l.innerText="Save",o.appendChild(l),d.addEventListener("input",function(){l.disabled=this.originalValue==this.value&&""==this.value}),l.addEventListener("click",function(){sendRequest(cmail,d.value)}),t.appendChild(n),t.appendChild(d),t.appendChild(o),document.querySelector("body").appendChild(t),addBD(),document.getElementById("mailform").style.display="block",document.querySelector("#bookmarks").addEventListener("click",hideMenu,!1)}),document.querySelectorAll(".mdcancel").forEach(e=>e.addEventListener("click",function(){hideMenu()})),document.getElementById("mpassword").addEventListener("click",function(){hideMenu(),addBD(),document.getElementById("passwordform").style.display="block",document.querySelector("#bookmarks").addEventListener("click",hideMenu,!1)}),document.getElementById("pbullet").addEventListener("click",function(){hideMenu(),addBD(),document.getElementById("pbulletform").style.display="block",document.querySelector("#bookmarks").addEventListener("click",hideMenu,!1)}),document.getElementById("nmessages").addEventListener("click",function(){hideMenu();let e=document.createElement("div");e.classList.add("db-spinner"),e.id="db-spinner",document.querySelector("body").appendChild(e),sendRequest(rmessage,null,"aNoti")}),document.getElementById("clientedt").addEventListener("click",function(){hideMenu(),sendRequest(getclients)}),document.getElementById("psettings").addEventListener("click",function(){hideMenu(),addBD(),document.getElementById("mngsform").style.display="block",document.querySelector("#bookmarks").addEventListener("click",hideMenu,!1)}),document.getElementById("duplicates").addEventListener("click",function(){hideMenu();let e=document.createElement("div");e.classList.add("db-spinner"),e.id="db-spinner",document.querySelector("body").appendChild(e),sendRequest(checkdups)}),document.getElementById("bexport").addEventListener("click",function(){hideMenu(),sendRequest(bexport,"html")}),
document.getElementById("footer").addEventListener("click",function(){hideMenu(),document.querySelector("#bookmarks").addEventListener("click",hideMenu,!1),addBD(),document.getElementById("bmarkadd").style.display="block",void 0!==navigator.clipboard.readText&&navigator.clipboard.readText().then(e=>{isValidUrl(e)&&(document.getElementById("url").value=e)}).catch(e=>{console.warn("Failed to read clipboard contents: ",e)}),url.focus(),url.addEventListener("input",enableSave)}),document.getElementById("mlog")&&document.getElementById("mlog").addEventListener("click",function(){hideMenu(),addBD();let e=document.getElementById("logfile");"visible"===e.style.visibility?(e.style.visibility="hidden",document.getElementById("close").style.visibility="hidden"):(e.style.visibility="visible",document.getElementById("close").style.visibility="visible",sendRequest(mlog))}),document.getElementById("mclear")&&document.getElementById("mclear").addEventListener("click",function(){sendRequest(mclear)}),document.getElementById("mrefresh")&&document.getElementById("mrefresh").addEventListener("click",logRefresh),document.getElementById("arefresh")&&document.getElementById("arefresh").addEventListener("change",logRefresh),document.getElementById("mclose")&&document.getElementById("mclose").addEventListener("click",function(){"visible"===document.getElementById("logfile").style.visibility&&(document.getElementById("logfile").style.visibility="hidden",document.getElementById("close").style.visibility="hidden",hideMenu())}),document.querySelectorAll("#mngcform .clientname").forEach(function(e){e.addEventListener("touchstart",function(){this.children[0].style.display="block"})}),document.querySelectorAll("#mngcform li div.clientname input").forEach(function(e){e.addEventListener("mouseleave",function(){this.defaultValue!=this.value&&(this.style.display="block",this.parentElement.parentElement.children[2].classList.add("renamea"),this.parentElement.parentElement.children[1].classList.add("renamea"),this.parentElement.parentElement.children[1].classList.remove("rename"),this.parentElement.parentElement.children[2].classList.remove("remove"))})}),document.getElementById("fname").addEventListener("input",function(){document.getElementById("fsave").disabled=!1}),document.getElementById("edtitle").addEventListener("input",function(){document.getElementById("edsave").disabled=!1}),document.getElementById("edurl").addEventListener("input",function(){document.getElementById("edsave").disabled=!1}),document.getElementById("mvfolder").addEventListener("change",function(){document.getElementById("mvsave").disabled=!1}),document.getElementById("fsave").addEventListener("click",function(e){e.preventDefault(),sendRequest(cfolder,document.getElementById("fname").value,document.getElementById("fbid").value)}),document.getElementById("edsave").addEventListener("click",function(e){e.preventDefault();let t=JSON.stringify({id:document.getElementById("edid").value,url:document.getElementById("edurl").value,title:document.getElementById("edtitle").value});sendRequest(bmedt,t)}),document.getElementById("mvsave").addEventListener("click",function(e){e.preventDefault(),sendRequest(bmmv,document.getElementById("mvfolder").value,document.getElementById("mvid").value),document.getElementById("bmamove").style.display="none"}),document.getElementById("mnubg").addEventListener("click",function(){hideMenu()}),addBookmarkEvents(),navigator.serviceWorker.ready.then(e=>{e.active&&e.active.postMessage({type:"bookmarks",data:document.getElementById("bookmarks").innerHTML})}))},!1),window.addEventListener("keydown",function(e){e.ctrlKey&&"KeyF"===e.code&&(e.preventDefault(),document.getElementById("bmsearch").focus(),document.querySelector("#menu button").innerHTML="×",document.querySelector("#menu input").value="",document.querySelector("#menu button").classList.add("asform"),document.querySelector("#menu input").classList.remove("isform"),document.querySelector("#menu input").classList.add("asform"),document.getElementById("mprofile").style.display="none",document.querySelector("#menu input").focus()),rmBm(e)});var bmIDs=new Array;const isValidUrl=e=>{let t;try{t=new URL(e)}catch(e){return!1}return"http:"===t.protocol||"https:"===t.protocol};